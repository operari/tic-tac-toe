"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _extendableBuiltin(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,s=Array(t.length);e<t.length;e++)s[e]=t[e];return s}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),Sound=function(){function t(e){_classCallCheck(this,t),this.element_=null,this.audio_=null,this.playing="",this.timings={hover:{start:0,end:.5,priority:1},click:{start:1,end:1.5,priority:2},tick:{start:2,end:2.5},dice:{start:3,end:3.5},flash:{start:4,end:5},draw:{start:5.5,end:6},win:{start:6.5,end:7.6},point:{start:8,end:9},swing:{start:9.5,end:10.4},level:{start:11,end:11.7},coin:{start:12,end:12.6},will:{start:13,end:15},tada:{start:15.5,end:17,priority:3},lock:{start:17.5,end:18.5,priority:3},coins:{start:19,end:19.8},coin1:{start:20.5,end:22}},this.fileName="sound.mp3",this.playerId="audio_player",this.wrapperId="wrapper",this.path="blocks/sound/",this.muted=!1,Object.assign(this,e),this.init()}return _createClass(t,[{key:"appendPlayer",value:function(){this.removePlayer();var t=document.getElementById(this.wrapperId),e='\n\t\t\t<div id="audio_player" class="sound">\n\t\t\t\t<audio preload="metadata" '+(this.muted?"muted":"")+'></audio>\n\t\t\t\t<button id="toggle_sound" class="ml-button--dim sound__toggle">\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="43" height="43" fill="#585f80" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/><path d="M0 0h24v24H0z" fill="none"/></svg>\n\t\t\t\t\t<svg class="is-hidden" xmlns="http://www.w3.org/2000/svg" width="43" height="43" fill="#585f80" viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/><path d="M0 0h24v24H0z" fill="none"/></svg>\n\t\t\t\t\t<span id="m" class="tttoe__key">m</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t';t.insertAdjacentHTML("beforeend",e),this.element_=document.getElementById(this.playerId),this.audioTrack()}},{key:"removePlayer",value:function(){var t=document.getElementById(this.playerId);t&&t.remove()}},{key:"audioTrack",value:function(){this.fileName&&(this.audio_=this.element_.querySelector("audio"),this.audio_.src=this.path+this.fileName+"?v="+Date.now())}},{key:"play",value:function(t){var e=this;if(this.audio_)return new Promise(function(s,n){if(e.compareTracksPriority(t)){e.playing=t,e.audio_.currentTime=e.timings[t].start;var i=e.audio_.play();void 0!==i&&i.then(function(n){e.timerId=setTimeout(function(){e.stop(),s()},1e3*(e.timings[t].end-e.timings[t].start))})["catch"](function(t){console.info(t)})}else s()})}},{key:"stop",value:function(){this.audio_&&(clearTimeout(this.timerId),this.audio_.pause(),this.audio_.currentTime=0,this.playing="")}},{key:"mute",value:function(){this.audio_.muted=!this.audio_.muted}},{key:"compareTracksPriority",value:function(t){return!(this.playing&&this.timings[this.playing].priority>=this.timings[t].priority)}},{key:"init",value:function(){var t=this,e=function(e){t.appendPlayer(),document.getElementById("toggle_sound").addEventListener("click",function(e){t.play("click");var s=e.currentTarget;s.children[+!t.audio_.muted].classList.remove("is-hidden"),s.children[+t.audio_.muted].classList.add("is-hidden"),setTimeout(function(){t.mute()},500)}),document.getElementById("toggle_sound").addEventListener("mouseenter",function(e){t.play("hover")}),document.addEventListener("keyup",function(t){"m"===t.key.toLowerCase()&&document.getElementById("m").parentNode.click()})};"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}}]),t}(),_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),Dice=function(){function t(){_classCallCheck(this,t),this.element=null,this.sides=6,this.animate=!0,this.__proto__.CssIds_={ELEM:"dice"},this.__proto__.CssClasses_={SIDE:"dice__side",DOT:"dice__dot",HIDDEN:"is-hidden",DICE:"dice",AUTO:"layout__auto",ANIMATED:"animated",ROTATEIN:"rotateIn"},this.__proto__.Constant_={ANIM_TIMING:1e3},this.init()}return _createClass(t,[{key:"makeSides",value:function(){if(this.element=document.getElementById(this.CssIds_.ELEM),this.element){this.dice=document.createElement("div"),this.dice.className=this.CssClasses_.DICE+" "+this.CssClasses_.AUTO+(this.animate?" "+this.CssClasses_.ANIMATED+" "+this.CssClasses_.ROTATEIN:"");for(var t=0,e=t+1;t<this.sides;t++,e++){var s=document.createElement("div");s.className=this.CssClasses_.SIDE+" "+this.CssClasses_.SIDE+"--"+e+" "+this.CssClasses_.HIDDEN,this.makeDots(s,e)&&(this.dice.appendChild(s),this.element.appendChild(this.dice))}return!0}return!1}},{key:"makeDots",value:function(t,e){if(t){for(var s=0;s<e;s++){var n=document.createElement("div");n.className=this.CssClasses_.DOT,t.appendChild(n)}return!0}return!1}},{key:"getRandomInt",value:function(t,e){return Math.floor(Math.random()*(e-t))+t}},{key:"play",value:function(){this.element.classList.remove(this.CssClasses_.HIDDEN);var t=this.getRandomInt(0,this.sides);return this.dice.children[t].classList.remove(this.CssClasses_.HIDDEN),this.animateDice(),t+1}},{key:"animateDice",value:function(){var t=this;this.animate&&setTimeout(function(){t.dice.classList.add(t.CssClasses_.ROTATEIN)},this.Constant_.ANIM_TIMING)}},{key:"init",value:function(){this.makeSides()}}]),t}(),_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),Confetti=function(){function t(e,s){return _classCallCheck(this,t),this.id=e,this.count=s,this.init()}return _createClass(t,[{key:"create",value:function(){var t=document.createElement("div");if(t.id=this.id,t.className="confetti",t){for(var e=this.count;e>-1;){var s=document.createElement("div");s.className="confetti__"+e,t.appendChild(s),e--}return t}throw new Error("Element .confetti not found!")}},{key:"init",value:function(){return this.create()}}]),t}(),_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),Pagination=function(){function t(e,s){_classCallCheck(this,t),this.allElements=e,this.limitPerPage=s,this.__proto__.CssClasses_={BLOCK:"pagination",CONTAINER:"pagination__marked-list",LIST:"pagination__list",LINK:"pagination__link",ACTIVE:"pagination__link--active",MIX_BLOCK:"tttoe__statistics-pagination",MIX_ACTION:"tttoe__button-action"}}return _createClass(t,[{key:"create",value:function(){var t=this,e=function(){for(var e="",s=1;s<=t.countPages;s++)e+='<li class="'+t.CssClasses_.LIST+'"><a href="#" class="'+t.CssClasses_.MIX_ACTION+" "+t.CssClasses_.LINK+" "+(1===s?t.CssClasses_.ACTIVE:"")+'">'+s+"</a></li>";return e},s='<div class="'+this.CssClasses_.BLOCK+" "+this.CssClasses_.MIX_BLOCK+'">\n\t\t\t<ul class="'+this.CssClasses_.CONTAINER+'">\n\t\t\t\t'+e()+"\n\t\t\t</ul>\n\t\t</div>";return s}},{key:"toggleActive",value:function(){var t=this,e=document.querySelector("."+this.CssClasses_.BLOCK),s=function(s){var n=s.target;if("A"===n.tagName){var i=e.querySelectorAll("."+t.CssClasses_.LINK);Array.from(i).forEach(function(e){return e.classList.remove(t.CssClasses_.ACTIVE)}),n.classList.add(t.CssClasses_.ACTIVE)}};e.addEventListener("click",s)}},{key:"init",value:function(){this.create()}},{key:"countPages",get:function(){return this.allElements/this.limitPerPage<=1?1:this.allElements/this.limitPerPage}}]),t}(),_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),ToggleScreen=function(){function t(e){_classCallCheck(this,t),this.elem=e||document.documentElement}return _createClass(t,[{key:"open",value:function(){this.elem.requestFullscreen?this.elem.requestFullscreen():this.elem.mozRequestFullScreen?this.elem.mozRequestFullScreen():this.elem.webkitRequestFullscreen?this.elem.webkitRequestFullscreen():this.elem.msRequestFullscreen&&this.elem.msRequestFullscreen()}},{key:"close",value:function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}}]),t}(),_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),Screen=function(){function t(){_classCallCheck(this,t),this.screen=null,this.dice=!0,this.options={},this.gameModes={training:["human","computer"],vs_computer:["human","computer"],vs_human:["human","human1"],network:"По сети"},this.sides={cross:"x",nil:"o"},this.__proto__.CssIds_={SCREEN:"screen",START:"start_game",CONTAINER:"container",MODE:"game_mode",MAIN:"game_main",SIDE:"game_side",FIRST:"first_move",DICE:"dice",WRP:"wrapper"},this.__proto__.CssClasses_={HIDDEN:"is-hidden",FADEOUT:"fadeOut",FADEIN:"fadeIn",ROTATEIN:"rotateIn",FLASH:"flash",FADEIN_DEF:"fadeInDef",DICE:"dice"},this.__proto__.Constant_={ANIM_TIMING:1e3,DICE_HIDE_TIMING:3e3,FULLSCREEN_TIMING:1e3}}return _createClass(t,[{key:"makeView",value:function(){var t='\n\t\t\t<div id="screen" class="screen animated fadeInDef">\n\t\t\t\t<div class="screen__inner">\n\t\t\t\t\t<div id="'+this.CssIds_.MAIN+'" class="screen__main animated">\n\t\t\t\t\t\t<h1 class="screen__title">Крестики-нолики</h1>\n\t\t\t\t\t\t<div class="screen__phrase">Классика игровой индустрии</div>\n\n\t\t\t\t\t\t<div class="screen__robot">\n\t\t\t\t\t\t\t<button type="button" id="'+this.CssIds_.START+'" class="screen__start">Начать игру</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="game_mode" class="screen__mode animated is-hidden">\n\t\t\t\t\t\t<h2 class="screen__display">Выберите режим игры:</h2>\n\t\t\t\t\t\t<button class="bg-color--pink" data-mode="training" data-players=\'{ "player1": "human", "player2": "computer" }\'>Тренировка</button>\n\t\t\t\t\t\t<button class="bg-color--blue" data-mode="vs_computer" data-players=\'{ "player1": "human", "player2": "computer" }\'>С компьютером</button>\n\t\t\t\t\t\t<button class="bg-color--gold" data-mode="vs_human" data-players=\'{ "player1": "human", "player2": "human1" }\'>С человеком</button>\n\t\t\t\t\t\t<button class="bg-color--purple" data-mode="network" data-players=\'{ "player1": "human", "player2": "human1" }\' disabled>По сети</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="'+this.CssIds_.SIDE+'" class="screen__side animated is-hidden">\n\t\t\t\t\t\t<h2 class="screen__display">Выберите сторону:</h2>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button class="screen__side-cross ml-button--fab" type="button" data-side="cross">x</button>\n\t\t\t\t\t\t\t<button class="screen__side-nil ml-button--fab" type="button" data-side="nil">o</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="'+this.CssIds_.FIRST+'" class="screen__pick-move animated is-hidden">\n\t\t\t\t\t\t<h2 class="screen__display">Выберите кто ходит первым:</h2>\n\t\t\t\t\t\t<button class="ml-button--color" data-run="human">Вы</button>\n\t\t\t\t\t\t<button class="ml-button--color" data-run="computer">Компьютер</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="'+this.CssIds_.DICE+'" class="screen__dice is-hidden animated">\n\t\t\t\t\t\t<button class="ml-button--color screen__dice--button">Начать</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t';document.getElementById(this.CssIds_.WRP).insertAdjacentHTML("beforeend",t),this.screen=document.getElementById(this.CssIds_.SCREEN)}},{key:"makeDiceWinner",value:function(){var t=Array.from(arguments),e=Math.max.apply(null,t),s=t.findIndex(function(t){return t===e});return this.options.run=this.gameModes[this.options.mode][s],s}},{key:"throwDice",value:function(){var t,e;this.sound.play("dice");do{var s=new Dice,n=new Dice;if(t=s.play(),e=n.play(),t===e){var i=document.querySelectorAll("."+this.CssClasses_.DICE);Array.from(i).forEach(function(t){return t.remove()})}}while(t===e);return this.makeDiceWinner(t,e)}},{key:"animate",value:function(t,e){var s=this;return!!t&&(t.classList.add(e),new Promise(function(t,e){setTimeout(function(){t()},s.Constant_.ANIM_TIMING)}))}},{key:"toggleView",value:function(t,e){var s=this,n=document.getElementById(t),i=document.getElementById(e);return!!n&&new Promise(function(t,e){s.animate(n,s.CssClasses_.FADEOUT).then(function(e){n.remove(),i?(i.classList.toggle(s.CssClasses_.HIDDEN),s.animate(i,s.dice?s.CssClasses_.FADEIN_DEF:s.CssClasses_.FADEIN).then(function(e){t(i)})):t()})})}},{key:"switchLastScreen",value:function(t,e){var s=t.dataset.mode;if(s){switch(s){case"training":document.getElementById(e[e.length-1]).remove(),e[e.length-1]=this.CssIds_.FIRST,this.dice=!1;break;default:document.getElementById(this.CssIds_.FIRST).remove()}return!0}return!1}},{key:"makeOptions",value:function(t,e){for(var s=0;s<e.length;s++){var n=t.dataset;n&&n[e[s]]&&("side"===e[s]?this.setTickType(n[e[s]]):"players"===e[s]?this.options[e[s]]=JSON.parse(n[e[s]]):this.options[e[s]]=n[e[s]])}}},{key:"setTickType",value:function(t){var e=this.options.mode;switch(this.options.tickType={human:t},e){case"vs_human":this.options.tickType.human1="cross"===t?"nil":"cross";break;default:this.options.tickType.computer="cross"===t?"nil":"cross"}}},{key:"controller",value:function(){var t=this,e=document.getElementById(this.CssIds_.START),s=[this.CssIds_.MAIN,this.CssIds_.MODE,this.CssIds_.SIDE,this.CssIds_.DICE];return new Promise(function(n,i){(function a(t,e){var s=this;if(e.length){if(1===e.length&&this.dice){var i=this.throwDice();setTimeout(function(){s.sound.play("flash");var t=document.querySelectorAll("."+s.CssClasses_.DICE)[i];t.classList.remove(s.CssClasses_.ROTATEIN),s.animate(t,s.CssClasses_.FLASH)},this.Constant_.ANIM_TIMING),setTimeout(function(){document.getElementById(s.CssIds_.DICE).querySelector("button").click(),n()},this.Constant_.DICE_HIDE_TIMING)}t.addEventListener("click",function(t){var n=t.target;if("BUTTON"===n.tagName){if(n.id&&n.id===s.CssIds_.START){var i=new ToggleScreen;setTimeout(function(){i.open()},s.Constant_.FULLSCREEN_TIMING)}s.sound.play("click"),s.switchLastScreen(n,e),s.makeOptions(n,["side","run","mode","players"]),s.toggleView(e[0],e[1]).then(function(t){return e.shift(),a.call(s,t,e)})}}),t.addEventListener("mouseover",function(t){t.target.classList.contains(s.CssClasses_.HIDDEN)||s.sound.play("hover")})}else n()}).call(t,e,s)})}},{key:"init",value:function(){var t=this,e=function(e){t.makeView(),t.sound=new Sound,t.options.sound=t.sound,t.controller().then(function(e){t.screen.classList.toggle(t.CssClasses_.HIDDEN),t.screen.classList.toggle(t.CssClasses_.FADEOUT),document.getElementById(t.CssIds_.SCREEN).remove();var s=new Game(t.options);s.init().then(function(t){return s.makeMove()})})};"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}}]),t}(),screen=new Screen;screen.init();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),test=!1,Game=function(){function t(e){_classCallCheck(this,t),this.fieldSize=9,this.run="human",this.mode="vs_computer",this.parti=3,this.difficulty="hard",this.store={},this.openMenu=!1,this.openChips=!1,this.animateChips=!0,this.players={player1:"human",player2:"computer"},this.names={human:["Вы","Игрок 1"],computer:"Компьютер",human1:"Игрок 2"},this.tickType={human:"cross",computer:"nil",human1:"nil"},this.numberingAxes={},this.multiplyingAxes={},this.additionAxes={},this.fieldCells={},this.count=0,this.state="",this.level=1,this.levelGrow={value:500,increase:50,bonusPercent:20,bonusLosePercent:5},this.expData={winPointsGame:100,losePercent:20,points:0,partiPoints:0,currentLevelExp:0,nextLevelExp:0},this.coinsData={coins:0,getExpInterval:500,getCoins:1,thresholdExp:0},this.volitionData={value:0,interval:10,points:99,increasePercent:10},this.randomCoinData={chancePercent:30,added:!1,index:-1},Object.defineProperty(this.coinsData,"needExp",{value:this.coinsData.getExpInterval,writable:!0}),this.score={0:{name:"star",cost:5,side:"x",paid:!1,pick:!1,lock:!0},1:{name:"heart",cost:6,side:"o",paid:!1,pick:!1,lock:!0},2:{name:"paw",cost:11,side:"x",paid:!1,pick:!1,lock:!0},3:{name:"cloud",cost:10,side:"o",paid:!1,pick:!1,lock:!0},4:{name:"snowflake",cost:15,side:"x",paid:!1,pick:!1,lock:!0},5:{name:"flush",cost:16,side:"o",paid:!1,pick:!1,lock:!0},6:{name:"cake",cost:21,side:"x",paid:!1,pick:!1,lock:!0},7:{name:"bomb",cost:20,side:"o",paid:!1,pick:!1,lock:!0},8:{name:"plane",cost:25,side:"x",paid:!1,pick:!1,lock:!0},9:{name:"basketball",cost:26,side:"o",paid:!1,pick:!1,lock:!0},length:10},this.statistics={data:[{name:"Саша",volition:50,coins:100,chip:"star",level:5},{name:"Виктор",volition:30,coins:70,chip:"heart",level:3}],fields:{ru:["Ник","Воля","Монеты","Фишка","Уровень"]},limit:10},this.__proto__.CssClasses_={FIELD:"tttoe",CELL:"tttoe__cell",TICK:"tttoe__tick",STORE:"tttoe__store",CHIP:"tttoe__chip",CHIPS_FOOT:"tttoe__chip-footer",CHIP_PAID:"tttoe__chip-paid",CHIPS:"tttoe__chips",CHIP_PICK:"tttoe__chip--pick",WIN:"tttoe__cell--winner",HIDDEN:"is-hidden",FADEIN_DEF:"fadeInDef",FADE_OUT:"fadeOut",MSG:"message",AVATAR:"tttoe__avatar",SHAKE:"shake",MENU:"tttoe__menu",FADEIN_LEFT:"fadeInLeftBig",FADEIN_RIGHT:"fadeOutRightBig",FLIP:"flip",FLASH:"flash",BOUNCE_IN:"bounceIn",BOUNCE_IN_UP:"bounceInUp",BOUNCE_OUT_UP:"bounceOutUp",BOUNCE_IN_DOWN:"bounceInDown",BOUNCE_OUT_DOWN:"bounceOutDown",TADA:"tada",COIN:"tttoe__coin",RUBBER_BAND:"rubberBand",BUTTON_ACT:"tttoe__button-action",LOCK:"tttoe__chip-lock",UNLOCK_CHIPS:"tttoe__chips-unlock",ANIM:"animated",CONFETTI_STATIC:"tttoe__chips-confetti",STATISTICS:"tttoe__statistics",ABOUT:"tttoe__about"},this.__proto__.CssIds_={APP:"game",CURSOR:"comp_cursor",WRP:"wrapper",CONTAINER:"container",MSG:"message",BAR:"menu_bar",CHIPS_BAR:"chips_bar",RESUME:"resume",MAIN_MENU:"main_menu",HOTKEYS:{f10:"menu",f:"chips"},LVL:"level",POINTS:"points",EXP:"experience",BONUS:"bonus",COINS:"coins",FIELD_WRP:"field_wrp",VOLITION:"volition"},this.__proto__.Constant_={SHAKE_TIMING:2e3,CONFETTI_TIMING:2e3,TICK_TIMING:500,MSG_ANIM_TIMING:1500,ANIM_TIMING:1e3,BONUS_TIMING:2e3,SOUND_INTERVAL:500,RESTART_PARTI:1e3,NEXT_LVL_TXT:"След. ур.: ",WILL:"Воля",VOLITION_COLOR:"#545bb0",TEXTS:{NEW_CHIP:{RU:"Новая фишка!"}}},Object.assign(this,e),this.partiRun=this.run}return _createClass(t,[{key:"countAxesValues",value:function(){for(var t=this,e=["x","y","z"],s=this.doCells(),n=Math.sqrt(this.fieldSize),i=function(i){var a=t.doMatrix(s,n,e[i]);t.numberingAxes[e[i]]=a;var o=t.doMatrix(s,n,e[i]);t.computeCells(o),t.multiplyingAxes[e[i]]=o.reduce(function(t,e){return t.concat(e)});var l=t.doMatrix(s,n,e[i]);t.additionAxes[e[i]]=t.sumAxissRows(l),t.computeCells(l,!1),t.additionAxes[e[i]].forEach(function(t,e){return t[Object.keys(t)[0]]=l[e]})},a=0;a<e.length;a++)i(a)}},{key:"doCells",value:function(){for(var t=[],e=1;e<=this.fieldSize;e++)t.push(e);return t}},{key:"doMatrix",value:function(t,e,s){function n(s,i,a){i=i||[],s=s,a=a;for(var o=1;o<=t.length;o++)o%e===1&&a.push(o+(i.length?s--:s++));return i.push(a),1===i.length?n(e-1,i,[]):i}var i=[],a=[];if("z"===s)return n(0,i,a);"y"===s&&(t=t.slice(0).sort(function(t,s){return t%e-s%e}));for(var o=1;o<=t.length;o++)a.push(t[o-1]),o%e||(i.push(a),a=[]);return i}},{key:"computeCells",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.forEach(function(t,s,n){var i=[];!function a(t){t.reduce(function(t,s,n,o){return o.length>1&&i.push(e?t*s:t+s),s===o[o.length-1]&&(o.shift(),a(o)),t})}(t),n[s]=i})}},{key:"sumAxissRows",value:function(t){return t.map(function(t){var e=t.reduce(function(t,e){return t+e}),s={};return s[e]=[],s})}},{key:"makeFieldCells",value:function(){for(var t=0;t<this.fieldSize;t++)this.fieldCells[t]={ticked:!1,tickType:"",position:t+1};this.fieldCells.length=this.fieldSize}},{key:"makeViewField",value:function(){for(var t=document.createElement("table"),e=Math.sqrt(this.fieldSize),s=0;s<e;s++){for(var n=document.createElement("tr"),i=0;i<e;i++){var a=document.createElement("td");a.className=this.CssClasses_.CELL,a.id=e*s+i;var o=document.createElement("div");o.className=this.CssClasses_.FIELD+"__inner",a.appendChild(o),n.appendChild(a)}t.appendChild(n)}return t.className=this.CssClasses_.FIELD,t}},{key:"makeView",value:function(){var t=this;this.pagination=new Pagination(this.statistics.data.length,this.statistics.limit);var e='\n\t\t\t<div id="container" class="layout__container is-hidden animated">\n\t\t\t\t<div id="game" class="layout__game">\n\t\t\t\t\t<div class="layout__header">\n\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t<div class="tttoe__coins">\n\t\t\t\t\t\t\t\t<div class="tttoe__coin animated"></div>\n\t\t\t\t\t\t\t\t<div id="'+this.CssIds_.COINS+'" class="tttoe__coins-count">'+this.coinsData.coins+'</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t<div id="chips_bar" class="tttoe__chips-bar">\n\t\t\t\t\t\t\t\t\t<button class="tttoe__button-action ml-button--dim" data-popup="'+this.CssClasses_.CHIPS+'">\n\t\t\t\t\t\t\t\t\t\t<div class="tttoe__chips-bar-ico"></div>\n\t\t\t\t\t\t\t\t\t\t<div id="f" class="tttoe__key">f</div>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div id="menu_bar" class="tttoe__menu-bar">\n\t\t\t\t\t\t\t\t\t<button class="tttoe__button-action ml-button--dim" data-popup="'+this.CssClasses_.MENU+'">\n\t\t\t\t\t\t\t\t\t\t<div class="tttoe__menu-bar-ico"></div>\n\t\t\t\t\t\t\t\t\t\t<div id="f10" class="tttoe__key">f10</div>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="status" class="tttoe__status row">\n\t\t\t\t\t\t\t<div id="player1" class="tttoe__player">\n\t\t\t\t\t\t\t\t<div class="tttoe__avatar">\n\t\t\t\t\t\t\t\t\t<img src="blocks/game/'+this.players.player1+'.png" alt="" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tttoe__name">'+this.playerFirstName+'</div>\n\t\t\t\t\t\t\t\t<div class="tttoe__store">0</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div id="player2" class="tttoe__player">\n\t\t\t\t\t\t\t\t<div class="tttoe__avatar">\n\t\t\t\t\t\t\t\t\t<img src="blocks/game/'+this.players.player2+'.png" alt="" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="tttoe__name">'+this.playerSecondName+'</div>\n\t\t\t\t\t\t\t\t<div class="tttoe__store">0</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="layout__middle">\n\t\t\t\t\t\t<div id="'+this.CssIds_.FIELD_WRP+'" class="tttoe__field-wrp row row--center">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div id="comp_cursor" class="tttoe__computer-cursor is-hidden"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="layout__footer">\n\t\t\t\t\t\t<div class="row row--right">\n\t\t\t\t\t\t\t<div class="tttoe__volition" data-title="'+this.Constant_.WILL+'">\n\t\t\t\t\t\t\t\t<div id="volition" class="tttoe__volition-count">0</div>\n\t\t\t\t\t\t\t\t<svg class="tttoe__volition-ico animated" width="42" height="42" fill="#ffffff" aria-hidden="true" data-prefix="fas" data-icon="brain" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M208 0c-29.87 0-54.74 20.55-61.8 48.22-.75-.02-1.45-.22-2.2-.22-35.34 0-64 28.65-64 64 0 4.84.64 9.51 1.66 14.04C52.54 138 32 166.57 32 200c0 12.58 3.16 24.32 8.34 34.91C16.34 248.72 0 274.33 0 304c0 33.34 20.42 61.88 49.42 73.89-.9 4.57-1.42 9.28-1.42 14.11 0 39.76 32.23 72 72 72 4.12 0 8.1-.55 12.03-1.21C141.61 491.31 168.25 512 200 512c39.77 0 72-32.24 72-72V205.45c-10.91 8.98-23.98 15.45-38.36 18.39-4.97 1.02-9.64-2.82-9.64-7.89v-16.18c0-3.57 2.35-6.78 5.8-7.66 24.2-6.16 42.2-27.95 42.2-54.04V64c0-35.35-28.66-64-64-64zm368 304c0-29.67-16.34-55.28-40.34-69.09 5.17-10.59 8.34-22.33 8.34-34.91 0-33.43-20.54-62-49.66-73.96 1.02-4.53 1.66-9.2 1.66-14.04 0-35.35-28.66-64-64-64-.75 0-1.45.2-2.2.22C422.74 20.55 397.87 0 368 0c-35.34 0-64 28.65-64 64v74.07c0 26.09 17.99 47.88 42.2 54.04 3.46.88 5.8 4.09 5.8 7.66v16.18c0 5.07-4.68 8.91-9.64 7.89-14.38-2.94-27.44-9.41-38.36-18.39V440c0 39.76 32.23 72 72 72 31.75 0 58.39-20.69 67.97-49.21 3.93.67 7.91 1.21 12.03 1.21 39.77 0 72-32.24 72-72 0-4.83-.52-9.54-1.42-14.11 29-12.01 49.42-40.55 49.42-73.89z"></path></svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tttoe__exp-bar">\n\t\t\t\t\t\t\t\t<span id="'+this.CssIds_.POINTS+'" class="tttoe__exp-points animated">'+this.expData.points+'</span>\n\t\t\t\t\t\t\t\t<div id="'+this.CssIds_.EXP+'" class="tttoe__experience" data-next-lvl="'+this.Constant_.NEXT_LVL_TXT+" "+this.setNextLevelExp()+'"><span></span></div>\n\t\t\t\t\t\t\t\t<div id="level" class="tttoe__level">Уровень: <span class="animated">'+this.level+'</span></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="layout__popups">\n\t\t\t\t\t\t<div class="tttoe__chips layout__substrate animated is-hidden" data-flag="openChips">\n\t\t\t\t\t\t\t<div class="tttoe__chips-inner layout__popup">\n\t\t\t\t\t\t\t\t<h3>Магазин</h3>\n\t\t\t\t\t\t\t\t<div class="row row--left">\n\t\t\t\t\t\t\t\t\t'+this.fillScore()+'\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<button class="tttoe__chips-close tttoe__button-action ml-button--dim" type="button"></button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tttoe__statistics layout__substrate animated is-hidden">\n\t\t\t\t\t\t\t<div class="tttoe__statistics-inner layout__popup">\n\t\t\t\t\t\t\t\t<h3>Статистика</h3>\n\t\t\t\t\t\t\t\t<div class="row row--left">\n\t\t\t\t\t\t\t\t\t'+this.fillStatistics()+"\n\t\t\t\t\t\t\t\t\t"+this.pagination.create()+'\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<button class="tttoe__chips-close tttoe__button-action ml-button--dim" type="button"></button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tttoe__about layout__substrate animated is-hidden">\n\t\t\t\t\t\t\t<div class="tttoe__about-inner layout__popup">\n\t\t\t\t\t\t\t\t<h3>Об игре</h3>\n\t\t\t\t\t\t\t\t<p class="tttoe__about-text">Крестики-нолики - игра нашего детства.\n\t\t\t\t\t\t\t\tИграйте против компьютера, друга или по сети.\n\t\t\t\t\t\t\t\tПолучайте опыт, прокачивайте уровень и разблокируйте эпичные фишки в магазине.\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<div class="tttoe__affiliate"></div>\n\t\t\t\t\t\t\t\t<p><b>Разработчик</b><br>Александр Радевич</p>\n\t\t\t\t\t\t\t\t<p><a href="http://operari.by" target="_blank">OPERARI</a></p>\n\t\t\t\t\t\t\t\t<button class="tttoe__chips-close tttoe__button-action ml-button--dim" type="button"></button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tttoe__menu layout__substrate animated is-hidden" data-flag="openMenu">\n\t\t\t\t\t\t\t<div class="game-menu">\n\t\t\t\t\t\t\t\t<button id="'+this.CssIds_.RESUME+'" class="game-menu__action tttoe__button-action bg-color--blue">Вернуться</button>\n\t\t\t\t\t\t\t\t<button class="game-menu__action tttoe__button-action bg-color--pink" data-popup="'+this.CssClasses_.STATISTICS+'">Статистика</button>\n\t\t\t\t\t\t\t\t<button class="game-menu__action tttoe__button-action bg-color--gold" data-popup="'+this.CssClasses_.ABOUT+'">Об игре</button>\n\t\t\t\t\t\t\t\t<button id="'+this.CssIds_.MAIN_MENU+'" class="game-menu__action tttoe__button-action bg-color--purple">Главное меню</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tttoe__chips-unlock is-hidden">\n\t\t\t\t\t\t\t<div class="tttoe__chips-confetti animated">\n\t\t\t\t\t\t\t\t<img src="blocks/game/confetti.png" alt="" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="message" class="tttoe__message animated animated--msg"></div>\n\t\t\t\t\t\t<div class="tttoe__bonus animated is-hidden"><div id="bonus"></div></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t',s=this.makeViewField();return new Promise(function(n,i){var a=function(i){var a=document.getElementById(t.CssIds_.WRP);a.insertAdjacentHTML("beforeend",e),t.fieldElement=document.getElementById(t.CssIds_.APP),document.getElementById(t.CssIds_.FIELD_WRP).firstElementChild.appendChild(s),t.appendRandomCoin(),t.showView(),n()};"complete"===document.readyState?a():document.addEventListener("DOMContentLoaded",a)})}},{key:"showView",value:function(){var t=document.getElementById(this.CssIds_.CONTAINER);t.classList.toggle(this.CssClasses_.HIDDEN),t.classList.toggle(this.CssClasses_.FADEIN_DEF)}},{key:"fillScore",value:function(){for(var t="",e=0;e<this.score.length;e++){var s=this.score[e],n='<button class="tttoe__chip tttoe__button-action ml-button--dim" data-index="'+e+'" '+(s.lock?"disabled":"")+'>\n\t\t\t\t\t<div class="tttoe__chip-ico tttoe__'+s.name+'"></div>\n\t\t\t\t\t<div class="tttoe__chip-footer">\n\t\t\t\t\t\t<span class="tttoe__coin tttoe__coin--mini animated"></span>\n\t\t\t\t\t\t<span class="tttoe__chip-cost">'+s.cost+"</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t"+(s.lock?'<div class="tttoe__chip-lock"><div></div></div>':"")+'\n\t\t\t\t\t<div class="tttoe__chip-side">'+s.side+"</div>\n\t\t\t\t</button>";
t+=n}return t}},{key:"fillStatistics",value:function(){for(var t=document.createElement("table"),e=function(){var e=document.createElement("tr");return t.appendChild(e),e},s=e(),n=0;n<this.statistics.fields.ru.length;n++){var i=document.createElement("th");i.textContent=this.statistics.fields.ru[n],s.appendChild(i)}for(var a=0;a<this.statistics.data.length&&!(a+1>this.statistics.limit);a++){var o=this.statistics.data[a],l=e();for(var r in o){var c=document.createElement("td");"chip"===r?c.innerHTML='<div class="tttoe__chip-ico tttoe__chip-ico--mini tttoe__'+o[r]+'"></div>':c.textContent=o[r],l.appendChild(c)}}return t.outerHTML}},{key:"makeMove",value:function(){switch(this.mode){case"vs_human":"human"===this.run?this.doHuman(this.players.player1,this.players.player2):this.doHuman(this.players.player2,this.players.player1);break;case"training":default:"human"===this.run?this.doHuman(this.players.player1,this.players.player2):this.doComputer()}}},{key:"highlightMove",value:function(){var t=this,e=Object.keys(this.players),s=Object.values(this.players),n=function(e){var s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.getElementById(e).querySelector("."+t.CssClasses_.AVATAR);n.classList[s?"add":"remove"](t.CssClasses_.AVATAR+"--highlight")},i=s.findIndex(function(e){return e===t.run});n(e[i]),i=s.findIndex(function(e){return e!==t.run}),n(e[i],!1)}},{key:"actionsAfterWin",value:function(t,e){var s=this;return new Promise(function(n,i){s.setStore(),s.setPoints(s.run),s.displayWinner(t,e),s.switchPartiPlayer();var a=s.getGameWinner();if(a){s.displayMessage(a);var o=s.getPartiLoser(a),l=s.getPlayerId(a),r=s.getPlayerId(o);s.throwConfetti(document.getElementById(l),s.Constant_.CONFETTI_TIMING),s.animate(document.getElementById(r).querySelector("."+s.CssClasses_.AVATAR),s.CssClasses_.SHAKE,s.Constant_.SHAK_TIMING),s.setPoints(a,!0).then(function(t){s.resetStores(),n()})}else setTimeout(function(){return n()},s.Constant_.RESTART_PARTI)})}},{key:"doHuman",value:function(t,e){function s(s){var i=this,a=s.target,o=a.closest("td");if("DIV"===a.tagName&&o){var l=o.id,r=this.tick(l,this.tickType[t]);if(r){this.fieldElement.removeEventListener("click",n);var c=this.checkWinnerCombination(!1,t);if(c)this.actionsAfterWin(c.comb,c.axis).then(function(t){i.restartParti().then(function(t){i.makeMove()})});else{if("computer"!==this.players.player2&&this.draw())return;this.run=e,this.randomCoinData.added&&l==this.randomCoinData.index?(this.setCoins(1,!0).then(function(t){i.makeMove()}),this.randomCoinData.added=!1):this.makeMove()}}}}this.highlightMove();var n=s.bind(this);"computer"!==this.run&&this.fieldElement.addEventListener("click",n)}},{key:"doComputer",value:function(){var t=this;this.highlightMove();var e=this.analysis(),s=e.cell-1;this.computerMoveAnimation(s).then(function(n){var i=t.tick(s,t.tickType[t.run]);t.state=t.count===t.fieldSize&&"win"!==t.state?"draw":t.state,"win"===t.state?i&&t.actionsAfterWin(e.comb,e.axis).then(function(e){t.restartParti().then(function(e){t.makeMove()})}):"draw"===t.state?(t.count=t.fieldSize,t.draw()):i&&setTimeout(function(){t.run="human",t.makeMove()},t.Constant_.TICK_TIMING)})}},{key:"tick",value:function(t,e){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!(!this.fieldCells[t]||this.fieldCells[t].ticked)&&(this.fieldCells[t].ticked=!0,this.fieldCells[t].tickType=e,this.displayTick(t,e),this.sound.play("tick"),this.count++,!0)}},{key:"checkWinnerCombination",value:function(t,e){function s(t){for(var e=function(e){var s=t[e],n=!1;if(i.length===s.length?n=i.every(function(t){return s.some(function(e){return t===e})}):i.length>s.length&&(n=s.every(function(t){return i.some(function(e){return t===e})})),n)return{v:s}},s=0;s<t.length;s++){var n=e(s);if("object"===("undefined"==typeof n?"undefined":_typeof(n)))return n.v}return!1}var n=this,i=Array.from(this.fieldCells).filter(function(t){return t.ticked&&t.tickType===n.tickType[e]}).map(function(t){return t.position});if(t){var a=this.numberingAxes[t];return s.call(this,a)}var o=[],l=[];for(var r in this.numberingAxes){var c=this.numberingAxes[r];l.push(s.call(this,c)),o.push(r)}var u=l.findIndex(function(t){return t.length});if(~u)return{comb:l[u],axis:this.makeRotateAxisClass(o[u],l[u])}}},{key:"analysis",value:function(){var t={};if(this.count<2){var e=!1,s=void 0;do s=this.getRandomInt(0,this.fieldSize),e=this.isTickedCell(s);while(e===!0);t.cell=s+1}else{var n=this.filterCells(),i=this.makePotentialCells(n.emptyCells,n.computerCells,"computer"),a=this.makePotentialCells(n.emptyCells,n.humanCells,"human");i.cell?(this.state="win",t=i):a.cell?t.cell="hard"===this.difficulty?a.cell:this.chooseRandomCell(i):i.length?t.cell=this.chooseRandomCell(i):a.length?t.cell=this.chooseRandomCell(a):(this.state="draw",t.cell=n.emptyCells[0]?n.emptyCells[0].position:-1)}return t}},{key:"filterCells",value:function(){var t=this,e=Array.from(this.fieldCells),s={};return s.emptyCells=e.filter(function(t){return!t.ticked}),s.humanCells=e.filter(function(e){return e.tickType===t.tickType.human}),s.computerCells=e.filter(function(e){return e.tickType===t.tickType.computer}),s}},{key:"makePotentialCells",value:function(t,e,s){for(var n=[],i=0;i<t.length;i++){var a=this.getPlayerPotentialCells(t[i].position,e,s);if(a){if("object"!==("undefined"==typeof a?"undefined":_typeof(a))||!a[0])return a;n.push(a)}}return n}},{key:"getPlayerPotentialCells",value:function(t,e,s){for(var n=[],i=0;i<e.length;i++){var a=e[i].position,o=a*t,l=this.getAxis(o);if(l){var r=a+t,c=this.getPotentialCell(l,r);if(c){var u=this.fieldCells[c-1];if(u.ticked){if(u.tickType===this.tickType[s]){var d=this.doTestTick(t,s);if(d){var h=this.checkWinnerCombination(l,s);if(this.doTestTick(t,!1,!1),h)return{cell:t,comb:h,axis:this.makeRotateAxisClass(l,h)}}}}else n.push(c)}}}return!!n.length&&n}},{key:"getPotentialCell",value:function(t,e){for(var s=this.additionAxes[t],n=0;n<s.length;n++){var i=Object.keys(s[n])[0],a=s[n][i],o=a.some(function(t){return t===e});if(o)return i-e}return!1}},{key:"isTickedCell",value:function(t){return!!this.fieldCells[t].ticked}},{key:"doTestTick",value:function(t,e){var s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=t-1;return s?(this.fieldCells[n].ticked=!0,this.fieldCells[n].tickType=this.tickType[e],!0):(this.fieldCells[n].ticked=!1,this.fieldCells[n].tickType="",!1)}},{key:"getAxis",value:function(t){for(var e in this.multiplyingAxes){var s=this.multiplyingAxes[e],n=s.some(function(e){return e===t});if(n)return e}return!1}},{key:"makeRotateAxisClass",value:function(t,e){return t="z"===t&&e.some(function(t){return 3===t})?t+"-45":t}},{key:"chooseRandomCell",value:function(t){t=t.reduce(function(t,e){return t.concat(e)});var e=new UniqueArray(t),s=e.unique(),n=this.getRandomInt(0,s.length),i=s[n];return i}},{key:"setStore",value:function(){"number"==typeof this.store[this.run]?this.store[this.run]+=1:this.store[this.run]=1,this.displayStore()}},{key:"setPoints",value:function(t,e){var s=this;if("vs_computer"===this.mode){if(e)return this.expData.points="human"===t?this.expData.points+this.bonusPoints:this.expData.points-this.bonusLosePoints,this.expData.points=Number.parseInt(this.expData.points),new Promise(function(e,n){setTimeout(function(){s.displayBonus(t).then(function(t){e()}),s.expData.partiPoints=0},s.Constant_.MSG_ANIM_TIMING)});this.expData.points="human"===t?this.expData.points+this.expData.winPointsGame:this.expData.points&&this.expData.points-this.losePoints,this.expData.partiPoints+="human"===t?this.expData.winPointsGame:0,this.gameWinPoints>0?this.levelUp():this.levelDown(),this.setCoins(),this.displayExperience()}}},{key:"setNextLevelExp",value:function(){return this.expData.nextLevelExp=(this.expData.nextLevelExp||this.expData.currentLevelExp)+this.levelGrow.value+this.level*this.levelGrow.increase,this.expData.nextLevelExp}},{key:"setCurrentLevelExp",value:function(){1===this.level?this.expData.currentLevelExp=0:this.expData.currentLevelExp=this.expData.currentLevelExp+this.levelGrow.value+(this.level-1)*this.levelGrow.increase-this.expData.currentLevelExp}},{key:"setCoins",value:function(t,e,s){var n=this;return t?(this.coinsData.coins+=t,new Promise(function(t,i){n.displayCoins(e,!1,s).then(function(e){n.unlockChips(),t()})})):void(this.expData.points>=this.coinsData.needExp&&(this.coinsData.coins+=this.coinsData.getCoins,this.coinsData.thresholdExp+=this.coinsData.getExpInterval,this.coinsData.needExp+=this.coinsData.getExpInterval,this.displayCoins(),this.unlockChips()))}},{key:"unlockChips",value:function(){var t=this,e=Array.from(this.score).filter(function(e){return e.cost<=t.coinsData.coins&&e.lock}),s=[];if(e.length&&e.forEach(function(e){e.lock=!1;var n=document.querySelector("."+t.CssClasses_.FIELD+"__"+e.name),i=n.parentNode;i.disabled=!1,i.querySelector("."+t.CssClasses_.LOCK).remove(),s.push(n)}),this.animateChips){var n=0;(function i(t,e){var s=this;e!==t.length&&this.displayUnlockChip(t[e]).then(function(n){return i.call(s,t,++e)})}).call(this,s,n)}}},{key:"setVolition",value:function(){if("vs_computer"===this.mode)if(this.volitionData.value+=1,this.volitionData.value%this.volitionData.interval)this.displayVolition();else{var t=this.volitionData.points+this.volitionData.value*this.volitionData.increasePercent/100,e=this.expData.winPointsGame;this.expData.winPointsGame=t,this.setPoints("human"),this.expData.winPointsGame=e,this.displayVolition(!0,t)}}},{key:"levelUp",value:function(){var t=this;this.expData.points>=this.expData.nextLevelExp&&(this.level++,this.expData.currentLevelExp=this.expData.nextLevelExp,this.setNextLevelExp(),setTimeout(function(){t.sound.play("level")},this.Constant_.SOUND_INTERVAL+200),this.displayLevel(),document.getElementById(this.CssIds_.EXP).dataset.nextLvl=this.Constant_.NEXT_LVL_TXT+this.expData.nextLevelExp)}},{key:"levelDown",value:function(){this.expData.points<this.expData.currentLevelExp&&(this.level--,this.expData.nextLevelExp=this.expData.currentLevelExp,this.setCurrentLevelExp(),this.displayLevel(!1),document.getElementById(this.CssIds_.EXP).dataset.nextLvl=this.Constant_.NEXT_LVL_TXT+this.expData.nextLevelExp)}},{key:"appendRandomCoin",value:function(){if("vs_computer"===this.mode){var t=this.getRandomInt(0,101);if(t<=this.randomCoinData.chancePercent){var e=this.getRandomInt(0,this.fieldSize),s=document.querySelector("."+this.CssClasses_.COIN).cloneNode();s.classList.add(this.CssClasses_.COIN+"--random"),s.classList.add(this.CssClasses_.HIDDEN);var n=document.querySelectorAll("."+this.CssClasses_.CELL)[e];n.firstElementChild.appendChild(s),this.randomCoinData.added=!0,this.randomCoinData.index=e}}}},{key:"getGameWinner",value:function(){var t=Object.values(this.store),e=t.reduce(function(t,e){return t+e});if(e===this.parti){this.sound.play("win");var s=Math.max.apply(null,t),n=t.findIndex(function(t){return t===s}),i=Object.keys(this.store)[n];this.getPlayerId(i);return i}return this.sound.play("point"),!1}},{key:"getPartiLoser",value:function(t){var e=Object.values(this.players),s=e.findIndex(function(e){return e!==t});return e[s]}},{key:"getPlayerId",value:function(t){for(var e in this.players)if(this.players[e]===t)return e;return!1}},{key:"switchPartiPlayer",value:function(){var t=this,e=Object.values(this.players);this.run=this.partiRun=e.find(function(e){return e!==t.partiRun})}},{key:"animate",value:function(t,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return!!t&&(t.classList.add(e),new Promise(function(i,a){setTimeout(function(){n&&t.classList.remove(e),i()},s)}))}},{key:"throwConfetti",value:function(t,e){if(t){var s=new Confetti("confetti",150);return t.appendChild(s),new Promise(function(t,n){setTimeout(function(){s.remove(),t()},e)})}return!1}},{key:"getRandomInt",value:function(t,e){return Math.floor(Math.random()*(e-t))+t}},{key:"getSoundInterval",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return 1e3*(this.sound.timings[t].end-this.sound.timings[t].start)+e}},{key:"getClassPickedChip",value:function(t){var e=this;if("computer"!==this.run){var s=Array.from(this.score).find(function(s){return s.pick&&s.side===e.transSymbolTextSide(t)});if(s)return" "+this.CssClasses_.FIELD+"__"+s.name}return""}},{key:"resetStores",value:function(){this.store={};for(var t=document.querySelectorAll("."+this.CssClasses_.STORE),e=0;e<t.length;e++)t[e].textContent=0}},{key:"displayStore",value:function(){for(var t in this.players)if(this.run===this.players[t]){document.getElementById(t).querySelector("."+this.CssClasses_.STORE).textContent=this.store[this.run];break}}},{key:"displayTick",value:function(t,e){var s=document.createElement("div");s.className=this.CssClasses_.TICK+" "+this.CssClasses_.TICK+"--"+this.tickType[this.run]+this.getClassPickedChip(e),this.fieldElement.querySelectorAll("td")[t].firstElementChild.appendChild(s)}},{key:"displayWinner",value:function(t,e){for(var s=0;s<t.length;s++)this.fieldElement.querySelectorAll("td")[t[s]-1].classList.add(this.CssClasses_.WIN+"-"+e)}},{key:"displayMessage",value:function(t){var e=this;if(t){var s=document.getElementById(this.CssIds_.MSG);s.classList.add(this.CssClasses_.MSG);var n="Выиграл";switch(t){case"human":n+="Вы"===this.playerFirstName?"и "+this.playerFirstName:" "+this.playerFirstName;break;case"draw":n="Ничья";break;default:n+=" "+this.names[t]}s.textContent=n+"!",setTimeout(function(){s.classList.remove(e.CssClasses_.MSG)},this.Constant_.MSG_ANIM_TIMING)}}},{key:"displayExperience",value:function(){var t=this.expData.nextLevelExp-this.expData.currentLevelExp,e=document.getElementById(this.CssIds_.EXP);e.firstElementChild.style.width=Number.parseInt(this.gameWinPoints/t*100)+"%",document.getElementById(this.CssIds_.POINTS).textContent=this.expData.points}},{key:"displayBonus",value:function(t,e){var s=this;return new Promise(function(n,i){var a=document.getElementById(s.CssIds_.BONUS);if(e)a.innerHTML='<span class="tttoe__bonus-volition">+'+e+'</span><span class="tttoe__bonus-msg">Воля</span>';else if("human"===t){if(!(s.bonusPoints>0))return n();a.innerHTML='<span class="tttoe__bonus-win">+'+Number.parseInt(s.bonusPoints)+'</span><span class="tttoe__bonus-msg">Бонус</span>'}else{if(!(s.bonusLosePoints>0))return n();a.innerHTML='<span class="tttoe__bonus-lose">-'+Number.parseInt(s.bonusLosePoints)+'</span><span class="tttoe__bonus-msg">Луз</span>'}a.parentNode.classList.toggle(s.CssClasses_.HIDDEN),s.sound.play("swing"),s.animate(a.parentNode,s.CssClasses_.FADEIN_LEFT,0,!1).then(function(t){setTimeout(function(){s.sound.play("swing"),s.animate(a.parentNode,s.CssClasses_.FADEIN_RIGHT,s.Constant_.ANIM_TIMING).then(function(t){a.parentNode.classList.toggle(s.CssClasses_.HIDDEN),a.parentNode.classList.toggle(s.CssClasses_.FADEIN_LEFT)}),n()},s.Constant_.BONUS_TIMING)})})}},{key:"displayCoins",value:function(t){var e=this,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];document.getElementById(this.CssIds_.COINS).textContent=this.coinsData.coins;var i=document.querySelectorAll("."+this.CssClasses_.COIN)[t?1:0];return i.classList.remove(this.CssClasses_.HIDDEN),s&&this.animate(document.getElementById(this.CssIds_.POINTS),this.CssClasses_.FLASH,this.Constant_.ANIM_TIMING),n&&this.sound.play("coin"),new Promise(function(s,n){e.animate(i,e.CssClasses_.FLIP,e.Constant_.ANIM_TIMING).then(function(e){t&&i.remove(),s()})})}},{key:"displayLevel",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],s=document.getElementById(this.CssIds_.LVL).firstElementChild;s.textContent=this.level,e&&setTimeout(function(){t.animate(s,t.CssClasses_.BOUNCE_IN,t.Constant_.ANIM_TIMING)},this.Constant_.SOUND_INTERVAL+200)}},{key:"displayVolition",value:function(t,e){var s=this,n=document.getElementById(this.CssIds_.VOLITION);n.textContent=this.volitionData.value,t&&(this.sound.play("will"),n.nextElementSibling.style.fill=this.Constant_.VOLITION_COLOR,this.animate(n.nextElementSibling,this.CssClasses_.RUBBER_BAND,this.Constant_.ANIM_TIMING).then(function(t){n.nextElementSibling.style.fill="#ffffff",s.displayBonus(null,e)}))}},{key:"displayUnlockChip",value:function(t){var e=this;return new Promise(function(s,n){var i=document.querySelector("."+e.CssClasses_.UNLOCK_CHIPS),a=i.querySelector("."+e.CssClasses_.CONFETTI_STATIC),o=document.querySelector("."+e.CssClasses_.BUTTON_ACT),l=t.cloneNode();l.classList.add(e.CssClasses_.ANIM);var r=document.createElement("span");r.textContent=e.Constant_.TEXTS.NEW_CHIP.RU,r.className=e.CssClasses_.ANIM,l.appendChild(r),i.appendChild(l),e.sound.play("swing"),o.disabled=!0,i.classList.toggle(e.CssClasses_.HIDDEN),e.animate(a,e.CssClasses_.BOUNCE_IN_DOWN,e.Constant_.ANIM_TIMING,!1),e.animate(l,e.CssClasses_.BOUNCE_IN_UP,e.Constant_.ANIM_TIMING,!1).then(function(t){e.animate(r,e.CssClasses_.TADA,0,!1),e.sound.play("tada").then(function(t){e.sound.play("swing"),e.animate(a,e.CssClasses_.BOUNCE_OUT_DOWN,e.Constant_.ANIM_TIMING).then(function(t){a.classList.remove(e.CssClasses_.BOUNCE_IN_DOWN)}),e.animate(l,e.CssClasses_.BOUNCE_OUT_UP,e.Constant_.ANIM_TIMING).then(function(t){l.remove(),o.disabled=!1,i.classList.toggle(e.CssClasses_.HIDDEN),s()})})})})}},{key:"restartParti",value:function(){var t=this;return new Promise(function(e,s){for(var n=Array.from(t.fieldCells),i=0;i<n.length;i++){n[i].ticked=!1,n[i].tickType="";var a=document.getElementById(i),o=Array.from(a.classList).find(function(t){return/winner/.test(t)});a.classList.remove(o);var l=a.querySelector("."+t.CssClasses_.TICK);l&&l.remove(),t.count=0,t.state=""}var r=document.querySelector("."+t.CssClasses_.FIELD).querySelector("."+t.CssClasses_.COIN);r&&r.remove(),t.randomCoinData.added=!1,t.randomCoinData.index=-1,t.appendRandomCoin(),e()})}},{key:"toggleScoreChipsDisplay",value:function(t,e){var s=this,n=t.classList.toggle(this.CssClasses_.CHIP_PICK);this.score[e].pick=n;var i=Array.from(document.querySelectorAll("."+this.CssClasses_.CHIP)),a=i.filter(function(t,n){return s.score[n].pick&&n!=e})[0];if(a){a.classList.remove(this.CssClasses_.CHIP_PICK);var o=this.score[a.dataset.index];return o.pick=!1,o}return!1}},{key:"toggleFieldChipsDisplay",value:function(t){var e=this,s=this.transSymbolTextSide(t.side),n=document.querySelectorAll("."+this.CssClasses_.TICK+"--"+s);n.length&&this.tickType.human===s&&Array.from(n).forEach(function(s){return s.classList.toggle(e.CssClasses_.FIELD+"__"+t.name)})}},{key:"transSymbolTextSide",value:function(t){return 1===t.length?"x"===t?"cross":"nil":"cross"===t?"x":"o"}},{key:"draw",value:function(){var t=this;return this.count===this.fieldSize&&(this.sound.play("draw"),this.displayMessage("draw"),this.switchPartiPlayer(),this.setVolition(),setTimeout(function(){t.restartParti().then(function(e){t.makeMove()})},this.Constant_.RESTART_PARTI),!0)}},{key:"computerMoveAnimation",value:function(t){var e=this;return new Promise(function(s,n){if(t>=0){var i=document.getElementById(t),a=i.offsetWidth/2,o=document.getElementById(e.CssIds_.CURSOR),l=i.offsetTop+a-o.offsetTop-o.offsetHeight+"px",r=o.offsetLeft-i.offsetLeft-a+"px";o.classList.remove(e.CssClasses_.HIDDEN),o.style.top=l,o.style.right=r,setTimeout(function(){o.classList.add(e.CssClasses_.HIDDEN),o.style.top="",o.style.right="",s()},1e3)}else s()})}},{key:"registerCallPopups",value:function(){var t=this;document.addEventListener("click",function(e){var s=t.findNode(e);if(s){var n=s.dataset&&s.dataset.popup;if(n&&!s.disabled){var i=document.querySelector("."+s.dataset.popup),a=t.popupToggle(i);"boolean"==typeof a&&a&&t[n.replace(/^.+__/,"")+"Actions"](i)}}})}},{key:"popupToggle",value:function(t){var e=this,s=t.dataset.flag;return this[s]?(t.removeEventListener("click",this.bindedHandler),new Promise(function(n,i){e[s]=!e[s],e.animate(t,e.CssClasses_.FADE_OUT,e.Constant_.ANIM_TIMING).then(function(s){t.classList.remove(e.CssClasses_.FADEIN_DEF),t.classList.toggle(e.CssClasses_.HIDDEN),n()})})):(t.classList.toggle(this.CssClasses_.HIDDEN),this.animate(t,this.CssClasses_.FADEIN_DEF,0,!1),this[s]=!this[s],!0)}},{key:"actionsHandler",value:function(t,e){function s(s){var n=s.target.closest("button")||s.target.closest("a");n&&(t.act(n,e),/(\b|__)close\b/.test(n.className)&&this.popupToggle(e))}this.bindedHandler=s.bind(this),this.bindedElem=e,e.addEventListener("click",this.bindedHandler)}},{key:"menuActions",value:function(t){var e=this;this.actionsHandler({act:function(t,s){e.popupToggle(s).then(function(s){t.id===e.CssIds_.MAIN_MENU&&e.restartGame()})}},t)}},{key:"chipsActions",value:function(t){var e=this;this.actionsHandler({act:function(t,s){if(t.classList.contains(e.CssClasses_.CHIP)&&!t.disabled){var n=t.dataset.index,i=e.score[n];if(e.buyChip(i,n)){var a=e.toggleScoreChipsDisplay(t,n);a&&e.toggleFieldChipsDisplay(a),e.toggleFieldChipsDisplay(i)}else setTimeout(function(){e.sound.play("coin1")},e.getSoundInterval("click"))}}},t)}},{key:"statisticsActions",value:function(t){this.pagination.toggleActive(),this.actionsHandler({act:function(t,e){console.log("act")}},t)}},{key:"aboutActions",value:function(t){this.actionsHandler({act:function(t,e){}},t)}},{key:"buyChip",value:function(t,e){var s=this;return!t.paid&&this.coinsData.coins-t.cost>=0?(this.setCoins(-t.cost,!1,!1),document.querySelector('button[data-index="'+e+'"]').querySelector("."+this.CssClasses_.CHIPS_FOOT).innerHTML='<div class="'+this.CssClasses_.CHIP_PAID+'"></div>',setTimeout(function(){s.sound.play("coins")},this.getSoundInterval("click")),t.paid=!0):t.paid}},{key:"restartGame",value:function(){var t=this,e=document.getElementById(this.CssIds_.CONTAINER);this.animate(e,this.CssClasses_.FADE_OUT,this.Constant_.ANIM_TIMING).then(function(s){e.classList.remove(t.CssClasses_.FADEIN_DEF),e.classList.add(t.CssClasses_.HIDDEN),e.remove();var n=new Screen;n.init(),n.screen.classList.remove(t.CssClasses_.FADE_OUT),n.screen.classList.remove(t.CssClasses_.HIDDEN);var i=new ToggleScreen;i.close()})}},{key:"findNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.CssClasses_.BUTTON_ACT;return t.target.closest("."+e)}},{key:"soundOfButtons",value:function(){var t=this;document.addEventListener("click",function(e){var s=t.findNode(e);s&&(s.disabled&&[].concat(_toConsumableArray(s.children)).some(function(e){return e.classList.contains(t.CssClasses_.LOCK)})?t.sound.play("lock"):t.sound.play("click"))}),document.addEventListener("mouseover",function(e){var s=t.findNode(e);s&&(s.dataset.hover||(t.sound.play("hover"),setTimeout(function(){s.dataset.hover=""},1e3)),s.dataset.hover=1)})}},{key:"triggers",value:function(){var t=this;document.addEventListener("keyup",function(e){var s=Object.keys(t.CssIds_.HOTKEYS),n=s.find(function(t){return t===e.key.toLowerCase()});n&&(t.bindedElem&&t.bindedElem.removeEventListener("click",t.bindedHandler),document.getElementById(n).closest("button").click())})}},{key:"init",value:function(){var t=this;return this.countAxesValues(),this.makeFieldCells(),new Promise(function(e,s){t.makeView().then(function(s){t.soundOfButtons(),t.triggers(),t.registerCallPopups(),e()})})}},{key:"playerFirstName",get:function(){return this.names[this.players.player1]["computer"===this.players.player2?0:1]}},{key:"playerSecondName",get:function(){return this.names[this.players.player2]}},{key:"losePoints",get:function(){return Number.parseInt(this.expData.winPointsGame*this.expData.losePercent/100)}},{key:"bonusPoints",get:function(){return this.expData.partiPoints*this.levelGrow.bonusPercent/100}},{key:"bonusLosePoints",get:function(){return this.expData.partiPoints*this.levelGrow.bonusLosePercent/100}},{key:"gameWinPoints",get:function(){return this.expData.points-this.expData.currentLevelExp}}]),t}(),UniqueArray=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"unique",value:function s(){this[0].sort(function(t,e){return t-e});var s=[];if(this[0].length>1)this[0].reduce(function(t,e,n,i){return t-e?(s.push(t),i[i.length-1]===i[n]&&s.push(e)):2===i.length&&s.push(e),e});else{if(!this[0].length)throw new Error("The array does not have a suitable length!");s=this[0]}return s}}]),e}(_extendableBuiltin(Array));if(test){var sound=new Sound,game=new Game({sound:sound});game.init().then(function(t){return game.makeMove()})}