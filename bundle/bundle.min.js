"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _extendableBuiltin(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),Sound=function(){function t(e){_classCallCheck(this,t),this.element_=null,this.audio_=null,this.timings={hover:{start:0,end:.5},click:{start:1,end:1.5},tick:{start:2,end:2.5},dice:{start:3,end:3.5},flash:{start:4,end:5},draw:{start:5.5,end:6},win:{start:6.5,end:7.6},point:{start:8,end:9}},this.fileName="sound.mp3",this.playerId="player",this.path="blocks/sound/",Object.assign(this,e),this.init()}return _createClass(t,[{key:"appendPlayer",value:function(){var t=document.getElementById(this.playerId);if(t&&!t.children.length){this.element_=t;var e=document.createElement("audio");return e.preload="metadata",t.appendChild(e),this.audio_=this.element_.querySelector("audio"),!0}return!1}},{key:"audioTrack",value:function(){this.fileName&&(this.audio_.src=this.path+this.fileName+"?v="+Date.now())}},{key:"play",value:function(t){var e=this;if(this.audio_){this.audio_.currentTime=this.timings[t].start;var s=this.audio_.play();void 0!==s&&s.then(function(s){e.timerId=setTimeout(function(){e.stop()},1e3*(e.timings[t].end-e.timings[t].start))})["catch"](function(t){console.error(t)})}}},{key:"stop",value:function(){this.audio_&&(clearTimeout(this.timerId),this.audio_.pause(),this.audio_.currentTime=0)}},{key:"init",value:function(){var t=this,e=function(e){t.appendPlayer(),t.audioTrack()};"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}}]),t}(),_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),Dice=function(){function t(){_classCallCheck(this,t),this.element=null,this.sides=6,this.animate=!0,this.__proto__.CssIds_={ELEM:"dice"},this.__proto__.CssClasses_={SIDE:"dice__side",DOT:"dice__dot",HIDDEN:"is-hidden",DICE:"dice",AUTO:"layout__auto",ANIMATED:"animated",ROTATEIN:"rotateIn"},this.__proto__.Constant_={ANIM_TIMING:1e3},this.init()}return _createClass(t,[{key:"makeSides",value:function(){if(this.element=document.getElementById(this.CssIds_.ELEM),this.element){this.dice=document.createElement("div"),this.dice.className=this.CssClasses_.DICE+" "+this.CssClasses_.AUTO+(this.animate?" "+this.CssClasses_.ANIMATED+" "+this.CssClasses_.ROTATEIN:"");for(var t=0,e=t+1;t<this.sides;t++,e++){var s=document.createElement("div");s.className=this.CssClasses_.SIDE+" "+this.CssClasses_.SIDE+"--"+e+" "+this.CssClasses_.HIDDEN,this.makeDots(s,e)&&(this.dice.appendChild(s),this.element.appendChild(this.dice))}return!0}return!1}},{key:"makeDots",value:function(t,e){if(t){for(var s=0;s<e;s++){var n=document.createElement("div");n.className=this.CssClasses_.DOT,t.appendChild(n)}return!0}return!1}},{key:"getRandomInt",value:function(t,e){return Math.floor(Math.random()*(e-t))+t}},{key:"play",value:function(){this.element.classList.remove(this.CssClasses_.HIDDEN);var t=this.getRandomInt(0,this.sides);return this.dice.children[t].classList.remove(this.CssClasses_.HIDDEN),this.animateDice(),t+1}},{key:"animateDice",value:function(){var t=this;this.animate&&setTimeout(function(){t.dice.classList.add(t.CssClasses_.ROTATEIN)},this.Constant_.ANIM_TIMING)}},{key:"init",value:function(){this.makeSides()}}]),t}(),_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),Confetti=function(){function t(e,s){return _classCallCheck(this,t),this.id=e,this.count=s,this.init()}return _createClass(t,[{key:"create",value:function(){var t=document.createElement("div");if(t.id=this.id,t.className="confetti",t){for(var e=this.count;e>-1;){var s=document.createElement("div");s.className="confetti__"+e,t.appendChild(s),e--}return t}throw new Error("Element .confetti not found!")}},{key:"init",value:function(){return this.create()}}]),t}(),_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),Screen=function(){function t(){_classCallCheck(this,t),this.screen=null,this.dice=!0,this.options={},this.gameModes={training:["human","computer"],vs_computer:["human","computer"],vs_human:["human","human1"],network:"По сети"},this.sides={cross:"x",nil:"o"},this.__proto__.CssIds_={SCREEN:"screen",START:"start_game",CONTAINER:"container",MODE:"game_mode",MAIN:"game_main",SIDE:"game_side",FIRST:"first_move",DICE:"dice"},this.__proto__.CssClasses_={HIDDEN:"is-hidden",FADEOUT:"fadeOut",FADEIN:"fadeIn",ROTATEIN:"rotateIn",FLASH:"flash",FADEIN_DEF:"fadeInDef",DICE:"dice"},this.__proto__.Constant_={ANIM_TIMING:1e3,DICE_HIDE_TIMING:3e3}}return _createClass(t,[{key:"makeView",value:function(){var t='<div class="screen__inner">\n\t\t\t\t<div id="'+this.CssIds_.MAIN+'" class="screen__main animated">\n\t\t\t\t\t<h1 class="screen__title">Крестики-нолики</h1>\n\t\t\t\t\t<div class="screen__phrase">Классика игровой индустрии</div>\n\n\t\t\t\t\t<div class="screen__robot">\n\t\t\t\t\t\t<button type="button" id="'+this.CssIds_.START+'" class="screen__start">Начать игру</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div id="game_mode" class="screen__mode animated is-hidden">\n\t\t\t\t\t<h2 class="screen__display">Выберите режим игры:</h2>\n\t\t\t\t\t<button class="screen__mode-training" data-mode="training" data-players=\'{ "player1": "human", "player2": "computer" }\'>Тренировка</button>\n\t\t\t\t\t<button class="screen__mode-computer" data-mode="vs_computer" data-players=\'{ "player1": "human", "player2": "computer" }\'>С компьютером</button>\n\t\t\t\t\t<button class="screen__mode-human" data-mode="vs_human" data-players=\'{ "player1": "human", "player2": "human1" }\'>С человеком</button>\n\t\t\t\t\t<button class="screen__mode-network" data-mode="network" data-players=\'{ "player1": "human", "player2": "human1" }\' disabled>По сети</button>\n\t\t\t\t</div>\n\t\t\t\t<div id="'+this.CssIds_.SIDE+'" class="screen__side animated is-hidden">\n\t\t\t\t\t<h2 class="screen__display">Выберите сторону:</h2>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button class="screen__side-cross ml-button--fab" type="button" data-side="cross">x</button>\n\t\t\t\t\t\t<button class="screen__side-nil ml-button--fab" type="button" data-side="nil">o</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div id="'+this.CssIds_.FIRST+'" class="screen__pick-move animated is-hidden">\n\t\t\t\t\t<h2 class="screen__display">Выберите кто ходит первым:</h2>\n\t\t\t\t\t<button class="ml-button--color" data-run="human">Вы</button>\n\t\t\t\t\t<button class="ml-button--color" data-run="computer">Компьютер</button>\n\t\t\t\t</div>\n\t\t\t\t<div id="'+this.CssIds_.DICE+'" class="screen__dice is-hidden animated">\n\t\t\t\t\t<button class="ml-button--color screen__dice--button">Начать</button>\n\t\t\t\t</div>\n\t\t\t</div>';this.screen.innerHTML+=t}},{key:"makeDiceWinner",value:function(){var t=Array.from(arguments),e=Math.max.apply(null,t),s=t.findIndex(function(t){return t===e});return this.options.run=this.gameModes[this.options.mode][s],s}},{key:"throwDice",value:function(){var t,e;this.sound.play("dice");do{var s=new Dice,n=new Dice;if(t=s.play(),e=n.play(),t===e){var i=document.querySelectorAll("."+this.CssClasses_.DICE);Array.from(i).forEach(function(t){return t.remove()})}}while(t===e);return this.makeDiceWinner(t,e)}},{key:"animate",value:function(t,e){var s=this;return!!t&&(t.classList.add(e),new Promise(function(t,e){setTimeout(function(){t()},s.Constant_.ANIM_TIMING)}))}},{key:"toggleView",value:function(t,e){var s=this,n=document.getElementById(t),i=document.getElementById(e);return!!n&&new Promise(function(t,e){s.animate(n,s.CssClasses_.FADEOUT).then(function(e){n.remove(),i?(i.classList.toggle(s.CssClasses_.HIDDEN),s.animate(i,s.dice?s.CssClasses_.FADEIN_DEF:s.CssClasses_.FADEIN).then(function(e){t(i)})):t()})})}},{key:"switchLastScreen",value:function(t,e){var s=t.dataset.mode;if(s){switch(s){case"training":document.getElementById(e[e.length-1]).remove(),e[e.length-1]=this.CssIds_.FIRST,this.dice=!1;break;default:document.getElementById(this.CssIds_.FIRST).remove()}return!0}return!1}},{key:"makeOptions",value:function(t,e){for(var s=0;s<e.length;s++){var n=t.dataset;n&&n[e[s]]&&("side"===e[s]?this.setTickType(n[e[s]]):"players"===e[s]?this.options[e[s]]=JSON.parse(n[e[s]]):this.options[e[s]]=n[e[s]])}}},{key:"setTickType",value:function(t){var e=this.options.mode;switch(this.options.tickType={human:t},e){case"vs_human":this.options.tickType.human1="cross"===t?"nil":"cross";break;default:this.options.tickType.computer="cross"===t?"nil":"cross"}}},{key:"controller",value:function(){var t=this,e=document.getElementById(this.CssIds_.START),s=[this.CssIds_.MAIN,this.CssIds_.MODE,this.CssIds_.SIDE,this.CssIds_.DICE];return new Promise(function(n,i){(function a(t,e){var s=this;if(e.length){if(1===e.length&&this.dice){var i=this.throwDice();setTimeout(function(){s.sound.play("flash");var t=document.querySelectorAll("."+s.CssClasses_.DICE)[i];t.classList.remove(s.CssClasses_.ROTATEIN),s.animate(t,s.CssClasses_.FLASH)},this.Constant_.ANIM_TIMING),setTimeout(function(){document.getElementById(s.CssIds_.DICE).querySelector("button").click(),n()},this.Constant_.DICE_HIDE_TIMING)}t.addEventListener("click",function(t){var n=t.target;"BUTTON"===n.tagName&&(s.sound.play("click"),s.switchLastScreen(n,e),s.makeOptions(n,["side","run","mode","players"]),s.toggleView(e[0],e[1]).then(function(t){return e.shift(),a.call(s,t,e)}))}),t.addEventListener("mouseover",function(t){s.sound.play("hover")})}else n()}).call(t,e,s)})}},{key:"init",value:function(){var t=this;document.addEventListener("DOMContentLoaded",function(e){t.screen=document.getElementById(t.CssIds_.SCREEN),t.screen&&(t.makeView(),t.sound=new Sound,t.options.sound=t.sound,t.controller().then(function(e){t.screen.classList.toggle(t.CssClasses_.HIDDEN),t.animate(t.screen,t.CssClasses_.FADEOUT);var s=new Game(t.options);s.init().then(function(t){return s.makeMove()})}))})}}]),t}(),screen=new Screen;screen.init();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),Game=function(){function t(e){_classCallCheck(this,t),this.fieldSize=9,this.run="computer",this.mode="training",this.parti=3,this.store={},this.players={player1:"human",player2:"computer"},this.names={human:["Вы","Игрок 1"],computer:"Компьютер",human1:"Игрок 2"},this.tickType={human:"cross",computer:"nil",human1:"nil"},this.numberingAxes={},this.multiplyingAxes={},this.additionAxes={},this.fieldCells={},this.count=0,this.state="",this.__proto__.CssClasses_={FIELD:"tttoe",CELL:"tttoe__cell",TICK:"tttoe__tick",STORE:"tttoe__store",WIN:"tttoe__cell--winner",HIDDEN:"is-hidden",FADEIN_DEF:"fadeInDef",MSG:"message",AVATAR:"tttoe__avatar",SHAKE:"shake"},this.__proto__.CssIds_={APP:"game",CURSOR:"comp_cursor",CONTAINER:"container",MSG:"message"},this.__proto__.Constant_={RESTART_TIMING:2e3,CONFETTI_TIMING:5e3,TICK_TIMING:500,MSG_ANIM_TIMING:1500},Object.assign(this,e),this.partiRun=this.run}return _createClass(t,[{key:"countAxesValues",value:function(){for(var t=this,e=["x","y","z"],s=this.doCells(),n=Math.sqrt(this.fieldSize),i=function(i){var a=t.doMatrix(s,n,e[i]);t.numberingAxes[e[i]]=a;var r=t.doMatrix(s,n,e[i]);t.computeCells(r),t.multiplyingAxes[e[i]]=r.reduce(function(t,e){return t.concat(e)});var o=t.doMatrix(s,n,e[i]);t.additionAxes[e[i]]=t.sumAxissRows(o),t.computeCells(o,!1),t.additionAxes[e[i]].forEach(function(t,e){return t[Object.keys(t)[0]]=o[e]})},a=0;a<e.length;a++)i(a)}},{key:"doCells",value:function(){for(var t=[],e=1;e<=this.fieldSize;e++)t.push(e);return t}},{key:"doMatrix",value:function(t,e,s){function n(s,i,a){i=i||[],s=s,a=a;for(var r=1;r<=t.length;r++)r%e===1&&a.push(r+(i.length?s--:s++));return i.push(a),1===i.length?n(e-1,i,[]):i}var i=[],a=[];if("z"===s)return n(0,i,a);"y"===s&&(t=t.slice(0).sort(function(t,s){return t%e-s%e}));for(var r=1;r<=t.length;r++)a.push(t[r-1]),r%e||(i.push(a),a=[]);return i}},{key:"computeCells",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.forEach(function(t,s,n){var i=[];!function a(t){t.reduce(function(t,s,n,r){return r.length>1&&i.push(e?t*s:t+s),s===r[r.length-1]&&(r.shift(),a(r)),t})}(t),n[s]=i})}},{key:"sumAxissRows",value:function(t){return t.map(function(t){var e=t.reduce(function(t,e){return t+e}),s={};return s[e]=[],s})}},{key:"makeFieldCells",value:function(){for(var t=0;t<this.fieldSize;t++)this.fieldCells[t]={ticked:!1,tickType:"",position:t+1};this.fieldCells.length=this.fieldSize}},{key:"makeViewField",value:function(){for(var t=document.createElement("table"),e=Math.sqrt(this.fieldSize),s=0;s<e;s++){for(var n=document.createElement("tr"),i=0;i<e;i++){var a=document.createElement("td");a.className=this.CssClasses_.CELL,a.id=e*s+i;var r=document.createElement("div");r.className=this.CssClasses_.FIELD+"__inner",a.appendChild(r),n.appendChild(a)}t.appendChild(n)}return t.className=this.CssClasses_.FIELD,t}},{key:"makeView",value:function(){var t=this,e='\n\t\t\t<div id="status" class="tttoe__status">\n\t\t\t\t<div id="player1" class="tttoe__player">\n\t\t\t\t\t<div class="tttoe__avatar">\n\t\t\t\t\t\t<img src="blocks/game/'+this.players.player1+'.png" alt="" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tttoe__name">'+this.playerFirstName+'</div>\n\t\t\t\t\t<div class="tttoe__store">0</div>\n\t\t\t\t</div>\n\t\t\t\t<div id="player2" class="tttoe__player">\n\t\t\t\t\t<div class="tttoe__avatar">\n\t\t\t\t\t\t<img src="blocks/game/'+this.players.player2+'.png" alt="" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tttoe__name">'+this.playerSecondName+'</div>\n\t\t\t\t\t<div class="tttoe__store">0</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div id="comp_cursor" class="tttoe__computer-cursor is-hidden"></div>\n\t\t\t<div id="message" class="tttoe__message animated animated--msg"></div>',s=this.makeViewField();return new Promise(function(n,i){var a=function(i){t.fieldElement=document.getElementById(t.CssIds_.APP),t.fieldElement.innerHTML+=e,t.fieldElement.appendChild(s),t.showView(),n()};"complete"===document.readyState?a():document.addEventListener("DOMContentLoaded",a)})}},{key:"showView",value:function(){var t=document.getElementById(this.CssIds_.CONTAINER);t.classList.toggle(this.CssClasses_.HIDDEN),t.classList.toggle(this.CssClasses_.FADEIN_DEF)}},{key:"makeMove",value:function(){switch(this.mode){case"vs_human":"human"===this.run?this.doHuman(this.players.player1,this.players.player2):this.doHuman(this.players.player2,this.players.player1);break;case"training":default:"human"===this.run?this.doHuman(this.players.player1,this.players.player2):this.doComputer()}}},{key:"highlightMove",value:function(){var t=this,e=Object.keys(this.players),s=Object.values(this.players),n=function(e){var s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.getElementById(e).querySelector("."+t.CssClasses_.AVATAR);n.classList[s?"add":"remove"](t.CssClasses_.AVATAR+"--highlight")},i=s.findIndex(function(e){return e===t.run});n(e[i]),i=s.findIndex(function(e){return e!==t.run}),n(e[i],!1)}},{key:"actionsAfterWin",value:function(t,e){this.setStore(),this.displayWinner(t,e),this.switchPartiPlayer();var s=this.getPartiWinner();if(this.displayMessage(s),s){var n=this.getPartiLoser(s),i=this.getPlayerId(s),a=this.getPlayerId(n);this.throwConfetti(document.getElementById(i),this.Constant_.CONFETTI_TIMING),this.animate(document.getElementById(a).querySelector("."+this.CssClasses_.AVATAR),this.CssClasses_.SHAKE,this.Constant_.RESTART_TIMING)}}},{key:"doHuman",value:function(t,e){function s(s){var i=this,a=s.target;if("DIV"===a.tagName){var r=a.closest("td").id,o=this.tick(r,this.tickType[t]);if(o){this.fieldElement.removeEventListener("click",n);var l=this.checkWinnerCombination(!1,t);if(l)this.actionsAfterWin(l.comb,l.axis),this.restartMove().then(function(t){i.makeMove()});else{if("computer"!==this.players.player2&&this.draw())return;this.run=e,this.makeMove()}}}}this.highlightMove();var n=s.bind(this);"computer"!==this.run&&this.fieldElement.addEventListener("click",n)}},{key:"doComputer",value:function(){var t=this;this.highlightMove();var e=this.analysis(),s=e.cell-1;this.computerMoveAnimation(s).then(function(n){var i=t.tick(s,t.tickType[t.run]);t.state=t.count===t.fieldSize&&"win"!==t.state?"draw":t.state,"win"===t.state?i&&(t.actionsAfterWin(e.comb,e.axis),t.restartMove().then(function(e){t.makeMove()})):"draw"===t.state?(t.count=t.fieldSize,t.draw()):i&&setTimeout(function(){t.run="human",t.makeMove()},t.Constant_.TICK_TIMING)})}},{key:"tick",value:function(t,e){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!(!this.fieldCells[t]||this.fieldCells[t].ticked)&&(this.fieldCells[t].ticked=!0,this.fieldCells[t].tickType=e,this.displayTick(t,e),this.sound.play("tick"),this.count++,!0)}},{key:"checkWinnerCombination",value:function(t,e){function s(t){for(var e=function(e){var s=t[e],n=!1;if(i.length===s.length?n=i.every(function(t){return s.some(function(e){return t===e})}):i.length>s.length&&(n=s.every(function(t){return i.some(function(e){return t===e})})),n)return{v:s}},s=0;s<t.length;s++){var n=e(s);if("object"===("undefined"==typeof n?"undefined":_typeof(n)))return n.v}return!1}var n=this,i=Array.from(this.fieldCells).filter(function(t){return t.ticked&&t.tickType===n.tickType[e]}).map(function(t){return t.position});if(t){var a=this.numberingAxes[t];return s.call(this,a)}var r=[],o=[];for(var l in this.numberingAxes){var u=this.numberingAxes[l];o.push(s.call(this,u)),r.push(l)}var c=o.findIndex(function(t){return t.length});if(~c)return{comb:o[c],axis:this.makeRotateAxisClass(r[c],o[c])}}},{key:"analysis",value:function(){var t={};if(this.count<2){var e=!1,s=void 0;do s=this.getRandomInt(0,this.fieldSize),e=this.isTickedCell(s);while(e===!0);t.cell=s+1}else{var n=this.filterCells(),i=this.makePotentialCells(n.emptyCells,n.computerCells,"computer"),a=this.makePotentialCells(n.emptyCells,n.humanCells,"human");i.cell?(this.state="win",t=i):a.cell?t.cell=a.cell:i.length?t.cell=this.chooseRandomCell(i):a.length?t.cell=this.chooseRandomCell(a):(this.state="draw",t.cell=n.emptyCells[0]?n.emptyCells[0].position:-1)}return t}},{key:"filterCells",value:function(){var t=this,e=Array.from(this.fieldCells),s={};return s.emptyCells=e.filter(function(t){return!t.ticked}),s.humanCells=e.filter(function(e){return e.tickType===t.tickType.human}),s.computerCells=e.filter(function(e){return e.tickType===t.tickType.computer}),s}},{key:"makePotentialCells",value:function(t,e,s){for(var n=[],i=0;i<t.length;i++){var a=this.getPlayerPotentialCells(t[i].position,e,s);if(a){if("object"!==("undefined"==typeof a?"undefined":_typeof(a))||!a[0])return a;n.push(a)}}return n}},{key:"getPlayerPotentialCells",value:function(t,e,s){for(var n=[],i=0;i<e.length;i++){var a=e[i].position,r=a*t,o=this.getAxis(r);if(o){var l=a+t,u=this.getPotentialCell(o,l);if(u){var c=this.fieldCells[u-1];if(c.ticked){if(c.tickType===this.tickType[s]){var h=this.doTestTick(t,s);if(h){var d=this.checkWinnerCombination(o,s);if(this.doTestTick(t,!1,!1),d)return{cell:t,comb:d,axis:this.makeRotateAxisClass(o,d)}}}}else n.push(u)}}}return!!n.length&&n}},{key:"getPotentialCell",value:function(t,e){for(var s=this.additionAxes[t],n=0;n<s.length;n++){var i=Object.keys(s[n])[0],a=s[n][i],r=a.some(function(t){return t===e});if(r)return i-e}return!1}},{key:"isTickedCell",value:function(t){return!!this.fieldCells[t].ticked}},{key:"doTestTick",value:function(t,e){var s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=t-1;return s?(this.fieldCells[n].ticked=!0,this.fieldCells[n].tickType=this.tickType[e],!0):(this.fieldCells[n].ticked=!1,this.fieldCells[n].tickType="",!1)}},{key:"getAxis",value:function(t){for(var e in this.multiplyingAxes){var s=this.multiplyingAxes[e],n=s.some(function(e){return e===t});if(n)return e}return!1}},{key:"makeRotateAxisClass",value:function(t,e){return t="z"===t&&e.some(function(t){return 3===t})?t+"-45":t}},{key:"chooseRandomCell",value:function(t){t=t.reduce(function(t,e){return t.concat(e)});var e=new UniqueArray(t),s=e.unique(),n=this.getRandomInt(0,s.length),i=s[n];return i}},{key:"setStore",value:function(){"number"==typeof this.store[this.run]?this.store[this.run]+=1:this.store[this.run]=1,this.displayStore()}},{key:"getPartiWinner",value:function(){var t=this,e=Object.values(this.store),s=e.reduce(function(t,e){return t+e});if(s===this.parti){this.sound.play("win");var n=Math.max.apply(null,e),i=e.findIndex(function(t){return t===n}),a=Object.keys(this.store)[i];this.getPlayerId(a);return setTimeout(function(){t.resetStores()},this.Constant_.RESTART_TIMING),a}return this.sound.play("point"),!1}},{key:"getPartiLoser",value:function(t){var e=Object.values(this.players),s=e.findIndex(function(e){return e!==t});return e[s]}},{key:"getPlayerId",value:function(t){for(var e in this.players)if(this.players[e]===t)return e;return!1}},{key:"switchPartiPlayer",value:function(){var t=this,e=Object.values(this.players);this.run=this.partiRun=e.find(function(e){return e!==t.partiRun})}},{key:"animate",value:function(t,e,s){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return!!t&&(t.classList.add(e),new Promise(function(i,a){setTimeout(function(){n&&t.classList.remove(e),i()},s)}))}},{key:"throwConfetti",value:function(t,e){if(t){var s=new Confetti("confetti",150);return t.appendChild(s),new Promise(function(t,n){setTimeout(function(){s.remove(),t()},e)})}return!1}},{key:"getRandomInt",value:function(t,e){return Math.floor(Math.random()*(e-t))+t}},{key:"resetStores",value:function(){this.store={};for(var t=document.querySelectorAll("."+this.CssClasses_.STORE),e=0;e<t.length;e++)t[e].textContent=0}},{key:"displayStore",value:function(){for(var t in this.players)if(this.run===this.players[t]){document.getElementById(t).querySelector("."+this.CssClasses_.STORE).textContent=this.store[this.run];break}}},{key:"displayTick",value:function(t,e){var s=document.createElement("div");s.className="tttoe__tick tttoe__tick--"+this.tickType[this.run],this.fieldElement.querySelectorAll("td")[t].firstElementChild.appendChild(s)}},{key:"displayWinner",value:function(t,e){for(var s=0;s<t.length;s++)this.fieldElement.querySelectorAll("td")[t[s]-1].classList.add(this.CssClasses_.WIN+"-"+e);console.log("Winner is: "+this.run),setTimeout(function(){},2e3)}},{key:"displayMessage",value:function(t){var e=this;if(t){var s=document.getElementById(this.CssIds_.MSG);s.classList.add(this.CssClasses_.MSG);var n="Выиграл";switch(t){case"human":n+="Вы"===this.playerFirstName?"и "+this.playerFirstName:" "+this.playerFirstName;break;case"draw":n="Ничья";break;default:n+=" "+this.names[this.run]}s.textContent=n+"!",setTimeout(function(){s.classList.remove(e.CssClasses_.MSG)},this.Constant_.MSG_ANIM_TIMING)}}},{key:"restartMove",value:function(){var t=this;return new Promise(function(e,s){setTimeout(function(){for(var s=Array.from(t.fieldCells),n=0;n<s.length;n++){s[n].ticked=!1,s[n].tickType="";var i=document.getElementById(n),a=Array.from(i.classList).find(function(t){return/winner/.test(t)});i.classList.remove(a);var r=i.querySelector("."+t.CssClasses_.TICK);r&&r.remove(),t.count=0,t.state=""}e()},t.Constant_.RESTART_TIMING)})}},{key:"draw",value:function(){var t=this;return this.count===this.fieldSize&&(this.sound.play("draw"),this.displayMessage("draw"),this.switchPartiPlayer(),this.restartMove().then(function(e){t.makeMove()}),!0)}},{key:"computerMoveAnimation",value:function(t){var e=this;return new Promise(function(s,n){if(t>=0){var i=document.getElementById(t),a=i.offsetWidth/2,r=document.getElementById(e.CssIds_.CURSOR),o=i.offsetTop+a-r.offsetTop-r.offsetHeight+"px",l=r.offsetLeft-i.offsetLeft-a+"px";r.classList.remove(e.CssClasses_.HIDDEN),r.style.top=o,r.style.right=l,setTimeout(function(){r.classList.add(e.CssClasses_.HIDDEN),r.style.top="",r.style.right="",s()},1e3)}else s()})}},{key:"init",value:function(){var t=this;return this.countAxesValues(),this.makeFieldCells(),new Promise(function(e,s){t.makeView().then(function(t){return e()})})}},{key:"playerFirstName",get:function(){return this.names[this.players.player1]["computer"===this.players.player2?0:1]}},{key:"playerSecondName",get:function(){return this.names[this.players.player2]}}]),t}(),UniqueArray=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"unique",value:function s(){this[0].sort(function(t,e){return t-e});var s=[];if(this[0].length>1)this[0].reduce(function(t,e,n,i){return t-e?(s.push(t),i[i.length-1]===i[n]&&s.push(e)):2===i.length&&s.push(e),e});else{if(!this[0].length)throw new Error("The array does not have a suitable length!");s=this[0]}return s}}]),e}(_extendableBuiltin(Array));