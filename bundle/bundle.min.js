"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _extendableBuiltin(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),Sound=function(){function t(e){_classCallCheck(this,t),this.element_=null,this.audio_=null,this.timings={hover:{start:0,end:.5},click:{start:1,end:1.5},tick:{start:2,end:2.5},dice:{start:3,end:3.5},flash:{start:4,end:5},draw:{start:5.5,end:6},win:{start:6.5,end:7.6},point:{start:8,end:9}},this.fileName="sound.mp3",this.playerId="player",this.path="blocks/sound/",Object.assign(this,e),this.init()}return _createClass(t,[{key:"appendPlayer",value:function(){var t=document.getElementById(this.playerId);if(t&&!t.children.length){this.element_=t;var e=document.createElement("audio");return e.preload="metadata",t.appendChild(e),this.audio_=this.element_.querySelector("audio"),!0}return!1}},{key:"audioTrack",value:function(){this.fileName&&(this.audio_.src=this.path+this.fileName+"?v="+Date.now())}},{key:"play",value:function(t){var e=this;if(this.audio_){this.audio_.currentTime=this.timings[t].start;var n=this.audio_.play();void 0!==n&&n.then(function(n){e.timerId=setTimeout(function(){e.stop()},1e3*(e.timings[t].end-e.timings[t].start))})["catch"](function(t){console.error(t)})}}},{key:"stop",value:function(){this.audio_&&(clearTimeout(this.timerId),this.audio_.pause(),this.audio_.currentTime=0)}},{key:"init",value:function(){var t=this,e=function(e){t.appendPlayer(),t.audioTrack()};"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),Dice=function(){function t(){_classCallCheck(this,t),this.element=null,this.sides=6,this.animate=!0,this.__proto__.CssIds_={ELEM:"dice"},this.__proto__.CssClasses_={SIDE:"dice__side",DOT:"dice__dot",HIDDEN:"is-hidden",DICE:"dice",AUTO:"layout__auto",ANIMATED:"animated",ROTATEIN:"rotateIn"},this.__proto__.Constant_={ANIM_TIMING:1e3},this.init()}return _createClass(t,[{key:"makeSides",value:function(){if(this.element=document.getElementById(this.CssIds_.ELEM),this.element){this.dice=document.createElement("div"),this.dice.className=this.CssClasses_.DICE+" "+this.CssClasses_.AUTO+(this.animate?" "+this.CssClasses_.ANIMATED+" "+this.CssClasses_.ROTATEIN:"");for(var t=0,e=t+1;t<this.sides;t++,e++){var n=document.createElement("div");n.className=this.CssClasses_.SIDE+" "+this.CssClasses_.SIDE+"--"+e+" "+this.CssClasses_.HIDDEN,this.makeDots(n,e)&&(this.dice.appendChild(n),this.element.appendChild(this.dice))}return!0}return!1}},{key:"makeDots",value:function(t,e){if(t){for(var n=0;n<e;n++){var s=document.createElement("div");s.className=this.CssClasses_.DOT,t.appendChild(s)}return!0}return!1}},{key:"getRandomInt",value:function(t,e){return Math.floor(Math.random()*(e-t))+t}},{key:"play",value:function(){this.element.classList.remove(this.CssClasses_.HIDDEN);var t=this.getRandomInt(0,this.sides);return this.dice.children[t].classList.remove(this.CssClasses_.HIDDEN),this.animateDice(),t+1}},{key:"animateDice",value:function(){var t=this;this.animate&&setTimeout(function(){t.dice.classList.add(t.CssClasses_.ROTATEIN)},this.Constant_.ANIM_TIMING)}},{key:"init",value:function(){this.makeSides()}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),Confetti=function(){function t(e,n){return _classCallCheck(this,t),this.id=e,this.count=n,this.init()}return _createClass(t,[{key:"create",value:function(){var t=document.createElement("div");if(t.id=this.id,t.className="confetti",t){for(var e=this.count;e>-1;){var n=document.createElement("div");n.className="confetti__"+e,t.appendChild(n),e--}return t}throw new Error("Element .confetti not found!")}},{key:"init",value:function(){return this.create()}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),ToggleScreen=function(){function t(e){_classCallCheck(this,t),this.elem=e||document.documentElement}return _createClass(t,[{key:"open",value:function(){this.elem.requestFullscreen?this.elem.requestFullscreen():this.elem.mozRequestFullScreen?this.elem.mozRequestFullScreen():this.elem.webkitRequestFullscreen?this.elem.webkitRequestFullscreen():this.elem.msRequestFullscreen&&this.elem.msRequestFullscreen()}},{key:"close",value:function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),Screen=function(){function t(){_classCallCheck(this,t),this.screen=null,this.dice=!0,this.options={},this.gameModes={training:["human","computer"],vs_computer:["human","computer"],vs_human:["human","human1"],network:"По сети"},this.sides={cross:"x",nil:"o"},this.__proto__.CssIds_={SCREEN:"screen",START:"start_game",CONTAINER:"container",MODE:"game_mode",MAIN:"game_main",SIDE:"game_side",FIRST:"first_move",DICE:"dice"},this.__proto__.CssClasses_={HIDDEN:"is-hidden",FADEOUT:"fadeOut",FADEIN:"fadeIn",ROTATEIN:"rotateIn",FLASH:"flash",FADEIN_DEF:"fadeInDef",DICE:"dice"},this.__proto__.Constant_={ANIM_TIMING:1e3,DICE_HIDE_TIMING:3e3,FULLSCREEN_TIMING:1e3}}return _createClass(t,[{key:"makeView",value:function(){var t='<div class="screen__inner">\n\t\t\t\t<div id="'+this.CssIds_.MAIN+'" class="screen__main animated">\n\t\t\t\t\t<h1 class="screen__title">Крестики-нолики</h1>\n\t\t\t\t\t<div class="screen__phrase">Классика игровой индустрии</div>\n\n\t\t\t\t\t<div class="screen__robot">\n\t\t\t\t\t\t<button type="button" id="'+this.CssIds_.START+'" class="screen__start">Начать игру</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div id="game_mode" class="screen__mode animated is-hidden">\n\t\t\t\t\t<h2 class="screen__display">Выберите режим игры:</h2>\n\t\t\t\t\t<button class="screen__mode-training" data-mode="training" data-players=\'{ "player1": "human", "player2": "computer" }\'>Тренировка</button>\n\t\t\t\t\t<button class="screen__mode-computer" data-mode="vs_computer" data-players=\'{ "player1": "human", "player2": "computer" }\'>С компьютером</button>\n\t\t\t\t\t<button class="screen__mode-human" data-mode="vs_human" data-players=\'{ "player1": "human", "player2": "human1" }\'>С человеком</button>\n\t\t\t\t\t<button class="screen__mode-network" data-mode="network" data-players=\'{ "player1": "human", "player2": "human1" }\' disabled>По сети</button>\n\t\t\t\t</div>\n\t\t\t\t<div id="'+this.CssIds_.SIDE+'" class="screen__side animated is-hidden">\n\t\t\t\t\t<h2 class="screen__display">Выберите сторону:</h2>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button class="screen__side-cross ml-button--fab" type="button" data-side="cross">x</button>\n\t\t\t\t\t\t<button class="screen__side-nil ml-button--fab" type="button" data-side="nil">o</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div id="'+this.CssIds_.FIRST+'" class="screen__pick-move animated is-hidden">\n\t\t\t\t\t<h2 class="screen__display">Выберите кто ходит первым:</h2>\n\t\t\t\t\t<button class="ml-button--color" data-run="human">Вы</button>\n\t\t\t\t\t<button class="ml-button--color" data-run="computer">Компьютер</button>\n\t\t\t\t</div>\n\t\t\t\t<div id="'+this.CssIds_.DICE+'" class="screen__dice is-hidden animated">\n\t\t\t\t\t<button class="ml-button--color screen__dice--button">Начать</button>\n\t\t\t\t</div>\n\t\t\t</div>';this.screen.innerHTML+=t}},{key:"makeDiceWinner",value:function(){var t=Array.from(arguments),e=Math.max.apply(null,t),n=t.findIndex(function(t){return t===e});return this.options.run=this.gameModes[this.options.mode][n],n}},{key:"throwDice",value:function(){var t,e;this.sound.play("dice");do{var n=new Dice,s=new Dice;if(t=n.play(),e=s.play(),t===e){var i=document.querySelectorAll("."+this.CssClasses_.DICE);Array.from(i).forEach(function(t){return t.remove()})}}while(t===e);return this.makeDiceWinner(t,e)}},{key:"animate",value:function(t,e){var n=this;return!!t&&(t.classList.add(e),new Promise(function(t,e){setTimeout(function(){t()},n.Constant_.ANIM_TIMING)}))}},{key:"toggleView",value:function(t,e){var n=this,s=document.getElementById(t),i=document.getElementById(e);return!!s&&new Promise(function(t,e){n.animate(s,n.CssClasses_.FADEOUT).then(function(e){s.remove(),i?(i.classList.toggle(n.CssClasses_.HIDDEN),n.animate(i,n.dice?n.CssClasses_.FADEIN_DEF:n.CssClasses_.FADEIN).then(function(e){t(i)})):t()})})}},{key:"switchLastScreen",value:function(t,e){var n=t.dataset.mode;if(n){switch(n){case"training":document.getElementById(e[e.length-1]).remove(),e[e.length-1]=this.CssIds_.FIRST,this.dice=!1;break;default:document.getElementById(this.CssIds_.FIRST).remove()}return!0}return!1}},{key:"makeOptions",value:function(t,e){for(var n=0;n<e.length;n++){var s=t.dataset;s&&s[e[n]]&&("side"===e[n]?this.setTickType(s[e[n]]):"players"===e[n]?this.options[e[n]]=JSON.parse(s[e[n]]):this.options[e[n]]=s[e[n]])}}},{key:"setTickType",value:function(t){var e=this.options.mode;switch(this.options.tickType={human:t},e){case"vs_human":this.options.tickType.human1="cross"===t?"nil":"cross";break;default:this.options.tickType.computer="cross"===t?"nil":"cross"}}},{key:"controller",value:function(){var t=this,e=document.getElementById(this.CssIds_.START),n=[this.CssIds_.MAIN,this.CssIds_.MODE,this.CssIds_.SIDE,this.CssIds_.DICE];return new Promise(function(s,i){(function r(t,e){var n=this;if(e.length){if(1===e.length&&this.dice){var i=this.throwDice();setTimeout(function(){n.sound.play("flash");var t=document.querySelectorAll("."+n.CssClasses_.DICE)[i];t.classList.remove(n.CssClasses_.ROTATEIN),n.animate(t,n.CssClasses_.FLASH)},this.Constant_.ANIM_TIMING),setTimeout(function(){document.getElementById(n.CssIds_.DICE).querySelector("button").click(),s()},this.Constant_.DICE_HIDE_TIMING)}t.addEventListener("click",function(t){var s=t.target;if("BUTTON"===s.tagName){if(s.id&&s.id===n.CssIds_.START){var i=new ToggleScreen;setTimeout(function(){i.open()},n.Constant_.FULLSCREEN_TIMING)}n.sound.play("click"),n.switchLastScreen(s,e),n.makeOptions(s,["side","run","mode","players"]),n.toggleView(e[0],e[1]).then(function(t){return e.shift(),r.call(n,t,e)})}}),t.addEventListener("mouseover",function(t){n.sound.play("hover")})}else s()}).call(t,e,n)})}},{key:"init",value:function(){var t=this;document.addEventListener("DOMContentLoaded",function(e){t.screen=document.getElementById(t.CssIds_.SCREEN),t.screen&&(t.makeView(),t.sound=new Sound,t.options.sound=t.sound,t.controller().then(function(e){t.screen.classList.toggle(t.CssClasses_.HIDDEN),t.animate(t.screen,t.CssClasses_.FADEOUT);var n=new Game(t.options);n.init().then(function(t){return n.makeMove()})}))})}}]),t}(),screen=new Screen;screen.init();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),Game=function(){function t(e){_classCallCheck(this,t),this.fieldSize=9,this.run="computer",this.mode="training",this.parti=3,this.store={},this.players={player1:"human",player2:"computer"},this.names={human:["Вы","Игрок 1"],computer:"Компьютер",human1:"Игрок 2"},this.tickType={human:"cross",computer:"nil",human1:"nil"},this.numberingAxes={},this.multiplyingAxes={},this.additionAxes={},this.fieldCells={},this.count=0,this.state="",this.__proto__.CssClasses_={FIELD:"tttoe",CELL:"tttoe__cell",TICK:"tttoe__tick",STORE:"tttoe__store",WIN:"tttoe__cell--winner",HIDDEN:"is-hidden",FADEIN_DEF:"fadeInDef",MSG:"message",AVATAR:"tttoe__avatar",SHAKE:"shake"},this.__proto__.CssIds_={APP:"game",CURSOR:"comp_cursor",CONTAINER:"container",MSG:"message"},this.__proto__.Constant_={RESTART_TIMING:2e3,CONFETTI_TIMING:5e3,TICK_TIMING:500,MSG_ANIM_TIMING:1500},Object.assign(this,e),this.partiRun=this.run}return _createClass(t,[{key:"countAxesValues",value:function(){for(var t=this,e=["x","y","z"],n=this.doCells(),s=Math.sqrt(this.fieldSize),i=function(i){var r=t.doMatrix(n,s,e[i]);t.numberingAxes[e[i]]=r;var a=t.doMatrix(n,s,e[i]);t.computeCells(a),t.multiplyingAxes[e[i]]=a.reduce(function(t,e){return t.concat(e)});var o=t.doMatrix(n,s,e[i]);t.additionAxes[e[i]]=t.sumAxissRows(o),t.computeCells(o,!1),t.additionAxes[e[i]].forEach(function(t,e){return t[Object.keys(t)[0]]=o[e]})},r=0;r<e.length;r++)i(r)}},{key:"doCells",value:function(){for(var t=[],e=1;e<=this.fieldSize;e++)t.push(e);return t}},{key:"doMatrix",value:function(t,e,n){function s(n,i,r){i=i||[],n=n,r=r;for(var a=1;a<=t.length;a++)a%e===1&&r.push(a+(i.length?n--:n++));return i.push(r),1===i.length?s(e-1,i,[]):i}var i=[],r=[];if("z"===n)return s(0,i,r);"y"===n&&(t=t.slice(0).sort(function(t,n){return t%e-n%e}));for(var a=1;a<=t.length;a++)r.push(t[a-1]),a%e||(i.push(r),r=[]);return i}},{key:"computeCells",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.forEach(function(t,n,s){var i=[];!function r(t){t.reduce(function(t,n,s,a){return a.length>1&&i.push(e?t*n:t+n),n===a[a.length-1]&&(a.shift(),r(a)),t})}(t),s[n]=i})}},{key:"sumAxissRows",value:function(t){return t.map(function(t){var e=t.reduce(function(t,e){return t+e}),n={};return n[e]=[],n})}},{key:"makeFieldCells",value:function(){for(var t=0;t<this.fieldSize;t++)this.fieldCells[t]={ticked:!1,tickType:"",position:t+1};this.fieldCells.length=this.fieldSize}},{key:"makeViewField",value:function(){for(var t=document.createElement("table"),e=Math.sqrt(this.fieldSize),n=0;n<e;n++){for(var s=document.createElement("tr"),i=0;i<e;i++){var r=document.createElement("td");r.className=this.CssClasses_.CELL,r.id=e*n+i;var a=document.createElement("div");a.className=this.CssClasses_.FIELD+"__inner",r.appendChild(a),s.appendChild(r)}t.appendChild(s)}return t.className=this.CssClasses_.FIELD,t}},{key:"makeView",value:function(){var t=this,e='\n\t\t\t<div id="status" class="tttoe__status">\n\t\t\t\t<div id="player1" class="tttoe__player">\n\t\t\t\t\t<div class="tttoe__avatar">\n\t\t\t\t\t\t<img src="blocks/game/'+this.players.player1+'.png" alt="" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tttoe__name">'+this.playerFirstName+'</div>\n\t\t\t\t\t<div class="tttoe__store">0</div>\n\t\t\t\t</div>\n\t\t\t\t<div id="player2" class="tttoe__player">\n\t\t\t\t\t<div class="tttoe__avatar">\n\t\t\t\t\t\t<img src="blocks/game/'+this.players.player2+'.png" alt="" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tttoe__name">'+this.playerSecondName+'</div>\n\t\t\t\t\t<div class="tttoe__store">0</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div id="comp_cursor" class="tttoe__computer-cursor is-hidden"></div>\n\t\t\t<div id="message" class="tttoe__message animated animated--msg"></div>',n=this.makeViewField();return new Promise(function(s,i){var r=function(i){t.fieldElement=document.getElementById(t.CssIds_.APP),t.fieldElement.innerHTML+=e,t.fieldElement.appendChild(n),t.showView(),s()};"complete"===document.readyState?r():document.addEventListener("DOMContentLoaded",r)})}},{key:"showView",value:function(){var t=document.getElementById(this.CssIds_.CONTAINER);t.classList.toggle(this.CssClasses_.HIDDEN),t.classList.toggle(this.CssClasses_.FADEIN_DEF)}},{key:"makeMove",value:function(){switch(this.mode){case"vs_human":"human"===this.run?this.doHuman(this.players.player1,this.players.player2):this.doHuman(this.players.player2,this.players.player1);break;case"training":default:"human"===this.run?this.doHuman(this.players.player1,this.players.player2):this.doComputer()}}},{key:"highlightMove",value:function(){var t=this,e=Object.keys(this.players),n=Object.values(this.players),s=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=document.getElementById(e).querySelector("."+t.CssClasses_.AVATAR);s.classList[n?"add":"remove"](t.CssClasses_.AVATAR+"--highlight")},i=n.findIndex(function(e){return e===t.run});s(e[i]),i=n.findIndex(function(e){return e!==t.run}),s(e[i],!1)}},{key:"actionsAfterWin",value:function(t,e){this.setStore(),this.displayWinner(t,e),this.switchPartiPlayer();var n=this.getPartiWinner();if(this.displayMessage(n),n){var s=this.getPartiLoser(n),i=this.getPlayerId(n),r=this.getPlayerId(s);this.throwConfetti(document.getElementById(i),this.Constant_.CONFETTI_TIMING),this.animate(document.getElementById(r).querySelector("."+this.CssClasses_.AVATAR),this.CssClasses_.SHAKE,this.Constant_.RESTART_TIMING)}}},{key:"doHuman",value:function(t,e){function n(n){var i=this,r=n.target;if("DIV"===r.tagName){var a=r.closest("td").id,o=this.tick(a,this.tickType[t]);if(o){this.fieldElement.removeEventListener("click",s);var l=this.checkWinnerCombination(!1,t);if(l)this.actionsAfterWin(l.comb,l.axis),this.restartMove().then(function(t){i.makeMove()});else{if("computer"!==this.players.player2&&this.draw())return;this.run=e,this.makeMove()}}}}this.highlightMove();var s=n.bind(this);"computer"!==this.run&&this.fieldElement.addEventListener("click",s)}},{key:"doComputer",value:function(){var t=this;this.highlightMove();var e=this.analysis(),n=e.cell-1;this.computerMoveAnimation(n).then(function(s){var i=t.tick(n,t.tickType[t.run]);t.state=t.count===t.fieldSize&&"win"!==t.state?"draw":t.state,"win"===t.state?i&&(t.actionsAfterWin(e.comb,e.axis),t.restartMove().then(function(e){t.makeMove()})):"draw"===t.state?(t.count=t.fieldSize,t.draw()):i&&setTimeout(function(){t.run="human",t.makeMove()},t.Constant_.TICK_TIMING)})}},{key:"tick",value:function(t,e){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!(!this.fieldCells[t]||this.fieldCells[t].ticked)&&(this.fieldCells[t].ticked=!0,this.fieldCells[t].tickType=e,this.displayTick(t,e),this.sound.play("tick"),this.count++,!0)}},{key:"checkWinnerCombination",value:function(t,e){function n(t){for(var e=function(e){var n=t[e],s=!1;if(i.length===n.length?s=i.every(function(t){return n.some(function(e){return t===e})}):i.length>n.length&&(s=n.every(function(t){return i.some(function(e){return t===e})})),s)return{v:n}},n=0;n<t.length;n++){var s=e(n);if("object"===("undefined"==typeof s?"undefined":_typeof(s)))return s.v}return!1}var s=this,i=Array.from(this.fieldCells).filter(function(t){return t.ticked&&t.tickType===s.tickType[e]}).map(function(t){return t.position});if(t){var r=this.numberingAxes[t];return n.call(this,r)}var a=[],o=[];for(var l in this.numberingAxes){var u=this.numberingAxes[l];o.push(n.call(this,u)),a.push(l)}var c=o.findIndex(function(t){return t.length});if(~c)return{comb:o[c],axis:this.makeRotateAxisClass(a[c],o[c])}}},{key:"analysis",value:function(){var t={};if(this.count<2){var e=!1,n=void 0;do n=this.getRandomInt(0,this.fieldSize),e=this.isTickedCell(n);while(e===!0);t.cell=n+1}else{var s=this.filterCells(),i=this.makePotentialCells(s.emptyCells,s.computerCells,"computer"),r=this.makePotentialCells(s.emptyCells,s.humanCells,"human");i.cell?(this.state="win",t=i):r.cell?t.cell=r.cell:i.length?t.cell=this.chooseRandomCell(i):r.length?t.cell=this.chooseRandomCell(r):(this.state="draw",t.cell=s.emptyCells[0]?s.emptyCells[0].position:-1)}return t}},{key:"filterCells",value:function(){var t=this,e=Array.from(this.fieldCells),n={};return n.emptyCells=e.filter(function(t){return!t.ticked}),n.humanCells=e.filter(function(e){return e.tickType===t.tickType.human}),n.computerCells=e.filter(function(e){return e.tickType===t.tickType.computer}),n}},{key:"makePotentialCells",value:function(t,e,n){for(var s=[],i=0;i<t.length;i++){var r=this.getPlayerPotentialCells(t[i].position,e,n);if(r){if("object"!==("undefined"==typeof r?"undefined":_typeof(r))||!r[0])return r;s.push(r)}}return s}},{key:"getPlayerPotentialCells",value:function(t,e,n){for(var s=[],i=0;i<e.length;i++){var r=e[i].position,a=r*t,o=this.getAxis(a);if(o){var l=r+t,u=this.getPotentialCell(o,l);if(u){var c=this.fieldCells[u-1];if(c.ticked){if(c.tickType===this.tickType[n]){var h=this.doTestTick(t,n);if(h){var d=this.checkWinnerCombination(o,n);if(this.doTestTick(t,!1,!1),d)return{cell:t,comb:d,axis:this.makeRotateAxisClass(o,d)}}}}else s.push(u)}}}return!!s.length&&s}},{key:"getPotentialCell",value:function(t,e){for(var n=this.additionAxes[t],s=0;s<n.length;s++){var i=Object.keys(n[s])[0],r=n[s][i],a=r.some(function(t){return t===e});if(a)return i-e}return!1}},{key:"isTickedCell",value:function(t){return!!this.fieldCells[t].ticked}},{key:"doTestTick",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=t-1;return n?(this.fieldCells[s].ticked=!0,this.fieldCells[s].tickType=this.tickType[e],!0):(this.fieldCells[s].ticked=!1,this.fieldCells[s].tickType="",!1)}},{key:"getAxis",value:function(t){for(var e in this.multiplyingAxes){var n=this.multiplyingAxes[e],s=n.some(function(e){return e===t});if(s)return e}return!1}},{key:"makeRotateAxisClass",value:function(t,e){return t="z"===t&&e.some(function(t){return 3===t})?t+"-45":t}},{key:"chooseRandomCell",value:function(t){t=t.reduce(function(t,e){return t.concat(e)});var e=new UniqueArray(t),n=e.unique(),s=this.getRandomInt(0,n.length),i=n[s];return i}},{key:"setStore",value:function(){"number"==typeof this.store[this.run]?this.store[this.run]+=1:this.store[this.run]=1,this.displayStore()}},{key:"getPartiWinner",value:function(){var t=this,e=Object.values(this.store),n=e.reduce(function(t,e){return t+e});if(n===this.parti){this.sound.play("win");var s=Math.max.apply(null,e),i=e.findIndex(function(t){return t===s}),r=Object.keys(this.store)[i];this.getPlayerId(r);return setTimeout(function(){t.resetStores()},this.Constant_.RESTART_TIMING),r}return this.sound.play("point"),!1}},{key:"getPartiLoser",value:function(t){var e=Object.values(this.players),n=e.findIndex(function(e){return e!==t});return e[n]}},{key:"getPlayerId",value:function(t){for(var e in this.players)if(this.players[e]===t)return e;return!1}},{key:"switchPartiPlayer",value:function(){var t=this,e=Object.values(this.players);this.run=this.partiRun=e.find(function(e){return e!==t.partiRun})}},{key:"animate",value:function(t,e,n){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return!!t&&(t.classList.add(e),new Promise(function(i,r){setTimeout(function(){s&&t.classList.remove(e),i()},n)}))}},{key:"throwConfetti",value:function(t,e){if(t){var n=new Confetti("confetti",150);return t.appendChild(n),new Promise(function(t,s){setTimeout(function(){n.remove(),t()},e)})}return!1}},{key:"getRandomInt",value:function(t,e){return Math.floor(Math.random()*(e-t))+t}},{key:"resetStores",value:function(){this.store={};for(var t=document.querySelectorAll("."+this.CssClasses_.STORE),e=0;e<t.length;e++)t[e].textContent=0}},{key:"displayStore",value:function(){for(var t in this.players)if(this.run===this.players[t]){document.getElementById(t).querySelector("."+this.CssClasses_.STORE).textContent=this.store[this.run];break}}},{key:"displayTick",value:function(t,e){var n=document.createElement("div");n.className="tttoe__tick tttoe__tick--"+this.tickType[this.run],this.fieldElement.querySelectorAll("td")[t].firstElementChild.appendChild(n)}},{key:"displayWinner",value:function(t,e){for(var n=0;n<t.length;n++)this.fieldElement.querySelectorAll("td")[t[n]-1].classList.add(this.CssClasses_.WIN+"-"+e);console.log("Winner is: "+this.run),setTimeout(function(){},2e3)}},{key:"displayMessage",value:function(t){var e=this;if(t){var n=document.getElementById(this.CssIds_.MSG);n.classList.add(this.CssClasses_.MSG);var s="Выиграл";switch(t){case"human":s+="Вы"===this.playerFirstName?"и "+this.playerFirstName:" "+this.playerFirstName;break;case"draw":s="Ничья";break;default:s+=" "+this.names[this.run]}n.textContent=s+"!",setTimeout(function(){n.classList.remove(e.CssClasses_.MSG)},this.Constant_.MSG_ANIM_TIMING)}}},{key:"restartMove",value:function(){var t=this;return new Promise(function(e,n){setTimeout(function(){for(var n=Array.from(t.fieldCells),s=0;s<n.length;s++){n[s].ticked=!1,n[s].tickType="";var i=document.getElementById(s),r=Array.from(i.classList).find(function(t){return/winner/.test(t)});i.classList.remove(r);var a=i.querySelector("."+t.CssClasses_.TICK);a&&a.remove(),t.count=0,t.state=""}e()},t.Constant_.RESTART_TIMING)})}},{key:"draw",value:function(){var t=this;return this.count===this.fieldSize&&(this.sound.play("draw"),this.displayMessage("draw"),this.switchPartiPlayer(),this.restartMove().then(function(e){t.makeMove()}),!0)}},{key:"computerMoveAnimation",value:function(t){var e=this;return new Promise(function(n,s){if(t>=0){var i=document.getElementById(t),r=i.offsetWidth/2,a=document.getElementById(e.CssIds_.CURSOR),o=i.offsetTop+r-a.offsetTop-a.offsetHeight+"px",l=a.offsetLeft-i.offsetLeft-r+"px";a.classList.remove(e.CssClasses_.HIDDEN),a.style.top=o,a.style.right=l,setTimeout(function(){a.classList.add(e.CssClasses_.HIDDEN),a.style.top="",a.style.right="",n()},1e3)}else n()})}},{key:"init",value:function(){var t=this;return this.countAxesValues(),this.makeFieldCells(),new Promise(function(e,n){t.makeView().then(function(t){return e()})})}},{key:"playerFirstName",get:function(){return this.names[this.players.player1]["computer"===this.players.player2?0:1]}},{key:"playerSecondName",get:function(){return this.names[this.players.player2]}}]),t}(),UniqueArray=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"unique",value:function n(){this[0].sort(function(t,e){return t-e});var n=[];if(this[0].length>1)this[0].reduce(function(t,e,s,i){return t-e?(n.push(t),i[i.length-1]===i[s]&&n.push(e)):2===i.length&&n.push(e),e});else{if(!this[0].length)throw new Error("The array does not have a suitable length!");n=this[0]}return n}}]),e}(_extendableBuiltin(Array));